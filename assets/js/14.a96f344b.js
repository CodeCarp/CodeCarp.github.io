(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{487:function(t,s,a){t.exports=a.p+"assets/img/image-20230630160531338.fb131f7d.png"},488:function(t,s,a){t.exports=a.p+"assets/img/image-20230630161331846.07741d29.png"},489:function(t,s,a){t.exports=a.p+"assets/img/image-20230718112544953.d6062066.png"},490:function(t,s,a){t.exports=a.p+"assets/img/image-20230718112758377.605cf57e.png"},491:function(t,s,a){t.exports=a.p+"assets/img/image-20230718113605316.556885bb.png"},492:function(t,s,a){t.exports=a.p+"assets/img/image-20230718113710921.3b1ac5da.png"},493:function(t,s,a){t.exports=a.p+"assets/img/image-20230718113855870.78d2c183.png"},494:function(t,s,a){t.exports=a.p+"assets/img/image-20230718113937520.325b805f.png"},495:function(t,s,a){t.exports=a.p+"assets/img/image-20230718114023544.c397af9e.png"},496:function(t,s,a){t.exports=a.p+"assets/img/image-20230718114117750.4969dc9b.png"},497:function(t,s,a){t.exports=a.p+"assets/img/image-20230718114131459.14de925f.png"},498:function(t,s,a){t.exports=a.p+"assets/img/image-20230718114508268.022357b4.png"},499:function(t,s,a){t.exports=a.p+"assets/img/image-20230718134632743.a6de7b90.png"},500:function(t,s,a){t.exports=a.p+"assets/img/image-20230718134706557.bcdc6875.png"},501:function(t,s,a){t.exports=a.p+"assets/img/image-20230718134849803.84d94da1.png"},995:function(t,s,a){"use strict";a.r(s);var n=a(27),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"三、环境搭建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、环境搭建"}},[t._v("#")]),t._v(" 三、环境搭建")]),t._v(" "),n("h3",{attrs:{id:"_3-1-创建项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-创建项目"}},[t._v("#")]),t._v(" 3.1 创建项目")]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RestController")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HelloController")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequestMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/hello"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("hello")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello Spring Security"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello Spring Security"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br")])]),n("h3",{attrs:{id:"_3-2-整合spring-security"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-整合spring-security"}},[t._v("#")]),t._v(" 3.2 整合Spring Security")]),t._v(" "),n("div",{staticClass:"language-xml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-security"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("h3",{attrs:{id:"_3-3-实现原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-实现原理"}},[t._v("#")]),t._v(" 3.3 实现原理")]),t._v(" "),n("blockquote",[n("p",[t._v("在SpringSecurity中"),n("strong",[t._v("认证")]),t._v("、"),n("strong",[t._v("授权")]),t._v("等功能都是基于"),n("strong",[t._v("过滤器")]),t._v("完成的。")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(487),alt:"image-20230630160531338"}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(488),alt:"image-20230630161331846"}})]),t._v(" "),n("blockquote",[n("p",[t._v("默认过滤器并不是直接放在Web项目的原生过滤器链中，而是通过一个FilterChainProxy来统一管理。SpringSecurity中的过滤器链通过FIlterChainProxy嵌入到Web项目的原生过滤器链中。FilterChainProxy作为一个顶层的管理者，将统一管理SecurityFilter。FilterChainProxy本身是通过Spring框架提供的DelegatingFilterProxy整合到原生的过滤器链中。")])]),t._v(" "),n("h3",{attrs:{id:"_3-4-security-filter"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-security-filter"}},[t._v("#")]),t._v(" 3.4 Security Filter")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("过滤器")]),t._v(" "),n("th",[t._v("过滤器作用")]),t._v(" "),n("th",[t._v("默认是否加载")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("ChannelProcessingFilter")]),t._v(" "),n("td",[t._v("过滤请求协议 HTTP 、HTTPS")]),t._v(" "),n("td",[t._v("NO")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("WebAsyncManagerIntegrationFilter")])]),t._v(" "),n("td",[t._v("将 WebAsyncManger 与 SpringSecurity 上下文进行集成")]),t._v(" "),n("td",[t._v("YES")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("SecurityContextPersistenceFilter")])]),t._v(" "),n("td",[t._v("在处理请求之前,将安全信息加载到 SecurityContextHolder 中")]),t._v(" "),n("td",[t._v("YES")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("HeaderWriterFilter")])]),t._v(" "),n("td",[t._v("处理头信息加入响应中")]),t._v(" "),n("td",[t._v("YES")])]),t._v(" "),n("tr",[n("td",[t._v("CorsFilter")]),t._v(" "),n("td",[t._v("处理跨域问题")]),t._v(" "),n("td",[t._v("NO")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("CsrfFilter")])]),t._v(" "),n("td",[t._v("处理 CSRF 攻击")]),t._v(" "),n("td",[t._v("YES")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("LogoutFilter")])]),t._v(" "),n("td",[t._v("处理注销登录")]),t._v(" "),n("td",[t._v("YES")])]),t._v(" "),n("tr",[n("td",[t._v("OAuth2AuthorizationRequestRedirectFilter")]),t._v(" "),n("td",[t._v("处理 OAuth2 认证重定向")]),t._v(" "),n("td",[t._v("NO")])]),t._v(" "),n("tr",[n("td",[t._v("Saml2WebSsoAuthenticationRequestFilter")]),t._v(" "),n("td",[t._v("处理 SAML 认证")]),t._v(" "),n("td",[t._v("NO")])]),t._v(" "),n("tr",[n("td",[t._v("X509AuthenticationFilter")]),t._v(" "),n("td",[t._v("处理 X509 认证")]),t._v(" "),n("td",[t._v("NO")])]),t._v(" "),n("tr",[n("td",[t._v("AbstractPreAuthenticatedProcessingFilter")]),t._v(" "),n("td",[t._v("处理预认证问题")]),t._v(" "),n("td",[t._v("NO")])]),t._v(" "),n("tr",[n("td",[t._v("CasAuthenticationFilter")]),t._v(" "),n("td",[t._v("处理 CAS 单点登录")]),t._v(" "),n("td",[t._v("NO")])]),t._v(" "),n("tr",[n("td",[t._v("OAuth2LoginAuthenticationFilter")]),t._v(" "),n("td",[t._v("处理 OAuth2 认证")]),t._v(" "),n("td",[t._v("NO")])]),t._v(" "),n("tr",[n("td",[t._v("Saml2WebSsoAuthenticationFilter")]),t._v(" "),n("td",[t._v("处理 SAML 认证")]),t._v(" "),n("td",[t._v("NO")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("UsernamePasswordAuthenticationFilter")])]),t._v(" "),n("td",[t._v("处理表单登录")]),t._v(" "),n("td",[t._v("YES")])]),t._v(" "),n("tr",[n("td",[t._v("OpenIDAuthenticationFilter")]),t._v(" "),n("td",[t._v("处理 OpenID 认证")]),t._v(" "),n("td",[t._v("NO")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("DefaultLoginPageGeneratingFilter")])]),t._v(" "),n("td",[t._v("配置默认登录页面")]),t._v(" "),n("td",[t._v("YES")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("DefaultLogoutPageGeneratingFilter")])]),t._v(" "),n("td",[t._v("配置默认注销页面")]),t._v(" "),n("td",[t._v("YES")])]),t._v(" "),n("tr",[n("td",[t._v("ConcurrentSessionFilter")]),t._v(" "),n("td",[t._v("处理 Session 有效期")]),t._v(" "),n("td",[t._v("NO")])]),t._v(" "),n("tr",[n("td",[t._v("DigestAuthenticationFilter")]),t._v(" "),n("td",[t._v("处理 HTTP 摘要认证")]),t._v(" "),n("td",[t._v("NO")])]),t._v(" "),n("tr",[n("td",[t._v("BearerTokenAuthenticationFilter")]),t._v(" "),n("td",[t._v("处理 OAuth2 认证的 Access Token")]),t._v(" "),n("td",[t._v("NO")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("BasicAuthenticationFilter")])]),t._v(" "),n("td",[t._v("处理 HttpBasic 登录")]),t._v(" "),n("td",[t._v("YES")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("RequestCacheAwareFilter")])]),t._v(" "),n("td",[t._v("处理请求缓存")]),t._v(" "),n("td",[t._v("YES")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("SecurityContextHolder<br />AwareRequestFilter")])]),t._v(" "),n("td",[t._v("包装原始请求")]),t._v(" "),n("td",[t._v("YES")])]),t._v(" "),n("tr",[n("td",[t._v("JaasApiIntegrationFilter")]),t._v(" "),n("td",[t._v("处理 JAAS 认证")]),t._v(" "),n("td",[t._v("NO")])]),t._v(" "),n("tr",[n("td",[t._v("RememberMeAuthenticationFilter")]),t._v(" "),n("td",[t._v("处理 RememberMe 登录")]),t._v(" "),n("td",[t._v("NO")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("AnonymousAuthenticationFilter")])]),t._v(" "),n("td",[t._v("配置匿名认证")]),t._v(" "),n("td",[t._v("YES")])]),t._v(" "),n("tr",[n("td",[t._v("OAuth2AuthorizationCodeGrantFilter")]),t._v(" "),n("td",[t._v("处理OAuth2认证中授权码")]),t._v(" "),n("td",[t._v("NO")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("SessionManagementFilter")])]),t._v(" "),n("td",[t._v("处理 session 并发问题")]),t._v(" "),n("td",[t._v("YES")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("ExceptionTranslationFilter")])]),t._v(" "),n("td",[t._v("处理认证/授权中的异常")]),t._v(" "),n("td",[t._v("YES")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("FilterSecurityInterceptor")])]),t._v(" "),n("td",[t._v("处理授权相关")]),t._v(" "),n("td",[t._v("YES")])]),t._v(" "),n("tr",[n("td",[t._v("SwitchUserFilter")]),t._v(" "),n("td",[t._v("处理账户切换")]),t._v(" "),n("td",[t._v("NO")])])])]),t._v(" "),n("h3",{attrs:{id:"_3-5-springboot对springsecurity的默认配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-springboot对springsecurity的默认配置"}},[t._v("#")]),t._v(" 3.5 SpringBoot对SpringSecurity的默认配置")]),t._v(" "),n("blockquote",[n("p",[t._v("SpringBootWebSecurityConfiguration这个类是SpringBoot自动配置类：")])]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Order")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2147483642")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityFilterChain")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("defaultSecurityFilterChain")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpSecurity")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AuthorizedUrl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("authorizeRequests")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("anyRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("authenticated")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("formLogin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("httpBasic")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityFilterChain")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br")])]),n("blockquote",[n("p",[t._v("默认情况下，对所有请求进行权限控制。（为什么SpringSecurity中没有任何配置情况下，请求会被拦截的原因。")]),t._v(" "),n("p",[t._v("默认生效条件为：")])]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DefaultWebSecurityCondition")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AllNestedConditions")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DefaultWebSecurityCondition")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConfigurationPhase")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("REGISTER_BEAN"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@ConditionalOnClass")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityFilterChain")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpSecurity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Classes")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@ConditionalOnMissingBean")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSecurityConfigurerAdapter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityFilterChain")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Beans")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br")])]),n("blockquote",[n("p",[t._v("条件一：classpath中存在SecurityFilterChain.class、HttpSecurity.class")]),t._v(" "),n("p",[t._v("条件二：没有自定义的WebSecurityConfigurerAdapter.class（主要用于自定义配置）、SecurityFilterChain.class（主要用于自定义Filter）")]),t._v(" "),n("p",[t._v("默认情况下，条件都是满足的。WebSecurityConfigAdapter这个类及其重要，SpringSecurity核心配置都在这个类中：")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(489),alt:"image-20230718112544953"}})]),t._v(" "),n("blockquote",[n("p",[t._v("如果要对SpringSecurity进行自定义配置，就要自定义这个类的实例，通过覆盖类中方法达到修改默认配置的目的。其中的config方法被经常使用：")])]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("configure")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpSecurity")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("logger"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("debug")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Using default configure(HttpSecurity). If subclassed this will potentially override subclass configure(HttpSecurity)."')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("authorizeRequests")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("requests"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExpressionUrlAuthorizationConfigurer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AuthorizedUrl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("requests"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("anyRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("authenticated")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("formLogin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("httpBasic")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br")])]),n("h3",{attrs:{id:"_3-6-流程分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-流程分析"}},[t._v("#")]),t._v(" 3.6 流程分析")]),t._v(" "),n("p",[n("img",{attrs:{src:a(490),alt:"image-20230718112758377"}})]),t._v(" "),n("blockquote",[n("ol",[n("li",[t._v("client请求 /hello 接口，在引入SpringSecurity后先经过一系列过滤器")]),t._v(" "),n("li",[t._v("在请求到达FilterSecurityInterceptor时，发现请求并未认证，请求被拦截下来，并抛出AccessDeniedException异常")]),t._v(" "),n("li",[t._v("抛出AccessDeniedException异常会被ExceptionTranslationFilter捕获，这个Filter中会调用LoginUrlAuthenticationEntryPoint#commence方法给客户端返回302，要求客户端进行重定向到 /login 页面。")]),t._v(" "),n("li",[t._v("客户端再次发送 /login 请求")]),t._v(" "),n("li",[t._v("/login 请求会被拦截器DefaultLoginPageGeneratingFilter拦截，并在拦截器中返回生成登录页面（纯代码拼接而成的页面）")])])]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DefaultLoginPageGeneratingFilter")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GenericFilterBean")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("h3",{attrs:{id:"_3-7-默认用户生成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-7-默认用户生成"}},[t._v("#")]),t._v(" 3.7 默认用户生成")]),t._v(" "),n("blockquote",[n("ol",[n("li",[t._v("查看SpringBootWebSecurityConfiguration#defaultSecurityFilterChain 方法表单登录")])])]),t._v(" "),n("p",[n("img",{attrs:{src:a(491),alt:"image-20230718113605316"}})]),t._v(" "),n("blockquote",[n("ol",{attrs:{start:"2"}},[n("li",[t._v("处理登录为FormLoginConfigurer类中 调用UsernamePasswordAuthenticationFilter这个类实例")])])]),t._v(" "),n("p",[n("img",{attrs:{src:a(492),alt:"image-20230718113710921"}})]),t._v(" "),n("blockquote",[n("ol",{attrs:{start:"3"}},[n("li",[t._v("查看类中UsernamePasswordAuthenticationFilter#attempAuthentication方法得知实际调用AuthenticationManager中authenticate方法")])])]),t._v(" "),n("p",[n("img",{attrs:{src:a(493),alt:"image-20230718113855870"}})]),t._v(" "),n("blockquote",[n("ol",{attrs:{start:"4"}},[n("li",[t._v("调用ProviderManager类中方法authenticate")])])]),t._v(" "),n("p",[n("img",{attrs:{src:a(494),alt:"image-20230718113937520"}})]),t._v(" "),n("blockquote",[n("ol",{attrs:{start:"5"}},[n("li",[t._v("调用了providerManager实现类中AbstractUserDetailsAuthenticationProvider类中方法")])])]),t._v(" "),n("p",[n("img",{attrs:{src:a(495),alt:"image-20230718114023544"}})]),t._v(" "),n("blockquote",[n("ol",{attrs:{start:"6"}},[n("li",[t._v("最终调用实现类DaoAuthenticationProvider 类中方法比较")])])]),t._v(" "),n("p",[n("img",{attrs:{src:a(496),alt:"image-20230718114117750"}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(497),alt:"image-20230718114131459"}})]),t._v(" "),n("blockquote",[n("p",[t._v("默认实现是基于InMemoryUserDetailsManager这个类，也就是内存的实现。")])]),t._v(" "),n("h3",{attrs:{id:"_3-8-userdetailservice"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-8-userdetailservice"}},[t._v("#")]),t._v(" 3.8 UserDetailService")]),t._v(" "),n("blockquote",[n("p",[t._v("通过刚才源码分析得知UserDetailService是顶层父接口，接口中LoadUserByUserName方法是用来在认证时进行用户名认证方法，默认实现使用是内存实现，如果想要修改数据库实现只需要自定义UserDetailService实现，最终返回UserDetails实例即可。")])]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserDetailsService")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserDetails")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadUserByUsername")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" username"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UsernameNotFoundException")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("p",[n("img",{attrs:{src:a(498),alt:"image-20230718114508268"}})]),t._v(" "),n("p",[t._v("###3.9 UserDetailServiceAutoConfigutation")]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserDetailsServiceConfigurer")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("blockquote",[n("ol",[n("li",[t._v("从自动配置源码中得知当classpath下存在AuthenticationManager类")]),t._v(" "),n("li",[t._v("当前项目中，系统没有提供AuthenticationManager.class、 AuthenticationProvider.class、UserDetailsService.class、AuthenticationManagerResolver.class实例。")]),t._v(" "),n("li",[t._v("默认情况下都会满足，此时SpringSecurity会提供一个InMemoryUserDetailsManager实例：")])])]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InMemoryUserDetailsManager")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserDetailsManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserDetailsPasswordService")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("blockquote",[n("p",[t._v("只要在配置文件中加入如下配置可以对内存中用户和密码进行覆盖。")])]),t._v(" "),n("div",{staticClass:"language-properties line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-properties"}},[n("code",[n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(" spring.security.user.name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("root")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(" spring.security.user.password")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("root")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(" spring.security.user.roles")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("admin,users")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("blockquote",[n("p",[t._v("重新启动项目后输入配置文件中的用户名和密码即可正常访问，原有登录方式失效。")])]),t._v(" "),n("h3",{attrs:{id:"_3-10-总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-10-总结"}},[t._v("#")]),t._v(" 3.10 总结")]),t._v(" "),n("blockquote",[n("p",[t._v("AuthenticationManager、ProviderManger、以及 AuthenticationProvider 关系：")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(499),alt:"image-20230718134632743"}})]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("WebSecurityConfigurerAdapter")]),t._v(" 扩展 Spring Security 所有默认配置：")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(500),alt:"image-20230718134706557"}})]),t._v(" "),n("blockquote",[n("p",[t._v("UserDetailService用来修改默认认证数据源信息")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(501),alt:"image-20230718134849803"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);