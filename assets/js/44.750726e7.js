(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{1052:function(e,_,v){"use strict";v.r(_);var t=v(27),s=Object(t.a)({},(function(){var e=this,_=e.$createElement,t=e._self._c||_;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h2",{attrs:{id:"redis哨兵-sentinel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis哨兵-sentinel"}},[e._v("#")]),e._v(" Redis哨兵（sentinel）")]),e._v(" "),t("h3",{attrs:{id:"_9-1-定义"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-定义"}},[e._v("#")]),e._v(" 9.1 定义")]),e._v(" "),t("blockquote",[t("p",[e._v("吹哨人巡查监控后台"),t("code",[e._v("master")]),e._v("主机是否故障，如果故障了根据投票数自动将某一个从库转换为新主库，继续对外服务。")])]),e._v(" "),t("h3",{attrs:{id:"_9-2-哨兵的作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-哨兵的作用"}},[e._v("#")]),e._v(" 9.2 哨兵的作用")]),e._v(" "),t("blockquote",[t("ol",[t("li",[t("strong",[e._v("主从监控")]),e._v("：监控主从"),t("code",[e._v("redis")]),e._v("库运行是否正常。")]),e._v(" "),t("li",[t("strong",[e._v("消息通知")]),e._v("：哨兵可以将故障转移的结果发送给客户端。")]),e._v(" "),t("li",[t("strong",[e._v("故障转移")]),e._v("：如果"),t("code",[e._v("master")]),e._v("异常，则会进行主从切换，将其中一个"),t("code",[e._v("slave")]),e._v("作为新"),t("code",[e._v("master")]),e._v("。")]),e._v(" "),t("li",[t("strong",[e._v("配置中心")]),e._v("：客户端通过连接哨兵来获得当前"),t("code",[e._v("redis")]),e._v("服务的主节点地址。")])])]),e._v(" "),t("h3",{attrs:{id:"_9-3-哨兵sentinel实操"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-3-哨兵sentinel实操"}},[e._v("#")]),e._v(" 9.3 哨兵sentinel实操")]),e._v(" "),t("blockquote",[t("ol",[t("li",[t("code",[e._v("/redis7")]),e._v("目录下新建或者拷贝"),t("code",[e._v("stntinel.conf")]),e._v("文件，名字决不能错。")]),e._v(" "),t("li",[e._v("先看看/"),t("code",[e._v("opt")]),e._v("目录下默认的"),t("code",[e._v("sentinel.conf")]),e._v("文件的内容；")]),e._v(" "),t("li",[e._v("重点参数项说明：\n"),t("ol",[t("li",[t("code",[e._v("bind")]),e._v("服务坚挺地址，用于客户端连接，默认本机地址")]),e._v(" "),t("li",[t("code",[e._v("daemonize")]),e._v("是否以后台"),t("code",[e._v("daemon")]),e._v("方式运行；")]),e._v(" "),t("li",[t("code",[e._v("protected-mode")]),e._v("安全保护模式；")]),e._v(" "),t("li",[t("code",[e._v("port")]),e._v("端口")]),e._v(" "),t("li",[t("code",[e._v("logfile")]),e._v("日志文件路径；")]),e._v(" "),t("li",[t("code",[e._v("pidfile``pid")]),e._v("文件路径；")]),e._v(" "),t("li",[t("code",[e._v("dir")]),e._v("工作目录；")]),e._v(" "),t("li",[t("code",[e._v("sentinel monitor <master-name> <ip> <redis-port> <quorum>")]),e._v("设置要监控的"),t("code",[e._v("master")]),e._v("服务器，"),t("code",[e._v("quorum")]),e._v("表示最少有几个哨兵认可客观下线，统一故障迁移的法定票数。")]),e._v(" "),t("li",[t("code",[e._v("sentinel auth-pass <master-name> <password>")]),e._v("主机"),t("code",[e._v("master")]),e._v("设置了密码，连接"),t("code",[e._v("master")]),e._v("服务的密码。")])])])])]),e._v(" "),t("h3",{attrs:{id:"_9-4-哨兵的运行流程与选举原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-4-哨兵的运行流程与选举原理"}},[e._v("#")]),e._v(" 9.4 哨兵的运行流程与选举原理")]),e._v(" "),t("blockquote",[t("p",[e._v("当一个主从配置中的"),t("code",[e._v("master")]),e._v("失效后，"),t("code",[e._v("sentinel")]),e._v("可以选举出一个新的"),t("code",[e._v("master")]),e._v("，用于自动接替原"),t("code",[e._v("master")]),e._v("的工作，主从配置中的其他"),t("code",[e._v("redis")]),e._v("服务器自动指向新的"),t("code",[e._v("master")]),e._v("同步数据。一般建议"),t("code",[e._v("sentinel")]),e._v("采取奇数台，防止某一台"),t("code",[e._v("sentinel")]),e._v("无法连接到"),t("code",[e._v("master")]),e._v("导致误切换。")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("SDown主观下线(Subjectively Down)")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("SDOWN（主观不可用）是"),t("strong",[e._v("单个sentinel自己主观上")]),e._v("检测到的关于master的状态，从sentinel的角度来看，如果发送了PING心跳后，在一定时间内没有收到合法的回复，就达到了SDOWN的条件。")])]),e._v(" "),t("li",[t("p",[e._v("sentinel配置文件中的down-after-milliseconds设置了判断主观下线的时间长度")])]),e._v(" "),t("li",[t("p",[e._v("说明")]),e._v(" "),t("p",[e._v("["),t("img",{attrs:{src:v(603),alt:"img"}}),e._v("]")])])])]),e._v(" "),t("li",[t("p",[e._v("ODown客观下线(Objectively Down)")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("ODOWN需要一定数量的sentinel，$\\textcolor{red}{多个哨兵达成一致意见}$才能认为一个master客观上已经宕机")])]),e._v(" "),t("li",[t("p",[e._v("说明")]),e._v(" "),t("p",[e._v("["),t("img",{attrs:{src:v(604),alt:"img"}}),e._v("]")]),e._v(" "),t("p",[e._v("这个参数是进行客观下线的一个依据，法定人数法定票数������这个参数是进行客观下线的一个依据，法定人数/法定票数 意思是至少有quorum个sentinel认为这个master有故障才会对这个master进行下线以及故障转移。因为有的时候，某个sentinel节点可能因为自身网络原因导致无法连接master，而此时master并没有出现故障，所以这就需要多个sentinel都一致认为该master有问题，才可以进行下一步操作，这就保证了公平性和高可用。")])])])])])])])}),[],!1,null,null,null);_.default=s.exports},603:function(e,_,v){e.exports=v.p+"assets/img/202307251550.2ccd768f.jpg"},604:function(e,_,v){e.exports=v.p+"assets/img/202307251552.d569b0ca.jpg"}}]);