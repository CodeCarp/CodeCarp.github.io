(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{1088:function(t,s,a){"use strict";a.r(s);var n=a(27),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"spring-task实现定时任务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#spring-task实现定时任务"}},[t._v("#")]),t._v(" Spring Task实现定时任务")]),t._v(" "),n("blockquote",[n("p",[t._v("Spring 3.0以后自带了task调度工具，比Quartz更加简单。")])]),t._v(" "),n("h2",{attrs:{id:"一、cron表达式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、cron表达式"}},[t._v("#")]),t._v(" 一、cron表达式")]),t._v(" "),n("blockquote",[n("p",[t._v("cron表达式是一个字符串，用来定义复杂的定时任务规则，由七部分组成，中间用空格隔开")])]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("组成部分")]),t._v(" "),n("th",[t._v("含义")]),t._v(" "),n("th",[t._v("取值范围")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("第一部分")]),t._v(" "),n("td",[t._v("Seconds（秒）")]),t._v(" "),n("td",[t._v("0——59")])]),t._v(" "),n("tr",[n("td",[t._v("第二部分")]),t._v(" "),n("td",[t._v("Minutes（分）")]),t._v(" "),n("td",[t._v("0——59")])]),t._v(" "),n("tr",[n("td",[t._v("第三部分")]),t._v(" "),n("td",[t._v("Hours（时）")]),t._v(" "),n("td",[t._v("0——23")])]),t._v(" "),n("tr",[n("td",[t._v("第四部分")]),t._v(" "),n("td",[t._v("Day-of-Month（天）")]),t._v(" "),n("td",[t._v("1——31")])]),t._v(" "),n("tr",[n("td",[t._v("第五部分")]),t._v(" "),n("td",[t._v("Month（月）")]),t._v(" "),n("td",[t._v("0——11或 JAN——DEC")])]),t._v(" "),n("tr",[n("td",[t._v("第六部分")]),t._v(" "),n("td",[t._v("Day-of-Week（周）")]),t._v(" "),n("td",[t._v("1——7（1 表示星期日）或SUN——SAT")])]),t._v(" "),n("tr",[n("td",[t._v("第七部分")]),t._v(" "),n("td",[t._v("Year（年）可选")]),t._v(" "),n("td",[t._v("1970——2099")])])])]),t._v(" "),n("blockquote",[n("p",[t._v("另外，cron表达式还可以包含一些特殊符号来定义更加灵活的定时规则")])]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("符号")]),t._v(" "),n("th",[t._v("含义")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("？")]),t._v(" "),n("td",[t._v("表示不确定的值，任意的一天")])]),t._v(" "),n("tr",[n("td",[t._v("*")]),t._v(" "),n("td",[t._v("表示整个时间段")])]),t._v(" "),n("tr",[n("td",[t._v("，")]),t._v(" "),n("td",[t._v("设置多个值，例如“26,29,33”表示在26分，29分和33分各自运行一次任务")])]),t._v(" "),n("tr",[n("td",[t._v("-")]),t._v(" "),n("td",[t._v("设置取值范围，例如“5-20”，表示从5分到20分钟每分钟运行一次")])]),t._v(" "),n("tr",[n("td",[t._v("/")]),t._v(" "),n("td",[t._v("设置频率或间隔，如”1/15“表示从1分开始，每隔15分钟运行一次")])]),t._v(" "),n("tr",[n("td",[t._v("L")]),t._v(" "),n("td",[t._v("用于每月或每周，表示每月的最后一天，或每个月的最后星期几，例如“6L“表示每月的最后一个星期五")])]),t._v(" "),n("tr",[n("td",[t._v("W")]),t._v(" "),n("td",[t._v("表示离给定日期最近的工作日，例如”15w“方在每月（day-of-month）上表示离分月15日最近的工作日")])]),t._v(" "),n("tr",[n("td",[t._v("#")]),t._v(" "),n("td",[t._v("表示该月的第几个周x，例如”6#3“表示该月的第三个周五")])])])]),t._v(" "),n("h2",{attrs:{id:"二、使用步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、使用步骤"}},[t._v("#")]),t._v(" 二、使用步骤")]),t._v(" "),n("h3",{attrs:{id:"_2-1-开启注解-enablescheduling"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-开启注解-enablescheduling"}},[t._v("#")]),t._v(" 2.1 开启注解 @EnableScheduling")]),t._v(" "),n("blockquote",[n("p",[t._v("Spring Boot默认在无任何第三方依赖的情况下使用，"),n("code",[t._v("Spring-context")]),t._v("模块下提供的定时任务工具"),n("strong",[t._v("Spring Task")]),t._v("。使用"),n("code",[t._v("@EnableScheduling")]),t._v("注解可以开启相关的定时任务功能。")])]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@EnableScheduling")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 😊😊 关注点")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@SpringBootApplication")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpringTaskApplication")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpringApplication")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpringTaskApplication")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("h3",{attrs:{id:"_2-2-自定义定时任务逻辑"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-自定义定时任务逻辑"}},[t._v("#")]),t._v(" 2.2 自定义定时任务逻辑")]),t._v(" "),n("blockquote",[n("p",[n("code",[t._v("@Scheduled")]),t._v("注解中需要声明定时任务的执行策略"),n("code",[t._v("cron")]),t._v("、"),n("code",[t._v("fixedDelay")]),t._v("、"),n("code",[t._v("fixedRate")])]),t._v(" "),n("p",[t._v("使用"),n("code",[t._v("@Scheduled")]),t._v("标记逻辑方法。")])]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Component")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TaskListImpl")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TaskList")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SimpleDateFormat")]),t._v(" sdf "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SimpleDateFormat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yyyy-MM-dd HH:mm:ss"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Scheduled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("initialDelay "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("fixedDelay "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 启动后，隔一秒开始执行，之后每个两秒执行一次")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Task1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Task1 "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" sdf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Scheduled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cron "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*/2 * * * * ?"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Task2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Task2 "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" sdf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br")])]),n("h4",{attrs:{id:"_2-2-1-注解详情"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-注解详情"}},[t._v("#")]),t._v(" 2.2.1 注解详情")]),t._v(" "),n("blockquote",[n("h4",{attrs:{id:"initialdelay"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#initialdelay"}},[t._v("#")]),t._v(" initialDelay")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("initialDelay")]),t._v(" 初始化延迟时间，也就是第一次延迟执行的时间。这个参数对 "),n("code",[t._v("cron")]),t._v(" 属性无效，只能配合 "),n("code",[t._v("fixedDelay")]),t._v(" 或 "),n("code",[t._v("fixedRate")]),t._v(" 使用。如 "),n("code",[t._v("@Scheduled(initialDelay=5000,fixedDelay = 1000)")]),t._v(" 表示第一次延迟 "),n("code",[t._v("5000")]),t._v(" 毫秒执行，下一次任务在上一次任务结束后 "),n("code",[t._v("1000")]),t._v(" 毫秒后执行。")])]),t._v(" "),n("h4",{attrs:{id:"fixeddelay"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#fixeddelay"}},[t._v("#")]),t._v(" fixedDelay")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("fixedDelay")]),t._v("。它的间隔时间是根据上次的任务结束的时候开始计时的，只要盯紧上一次执行结束的时间即可，跟任务逻辑的执行时间无关，两个轮次的间隔距离是固定的。")])])]),t._v(" "),n("p",[n("img",{attrs:{src:a(909),alt:"image.png"}})])])}),[],!1,null,null,null);s.default=e.exports},909:function(t,s,a){t.exports=a.p+"assets/img/image-20230809091302735.58c5ec33.png"}}]);