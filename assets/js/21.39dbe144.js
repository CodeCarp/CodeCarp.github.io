(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{1050:function(v,e,_){"use strict";_.r(e);var t=_(27),a=Object(t.a)({},(function(){var v=this,e=v.$createElement,t=v._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[t("h2",{attrs:{id:"redis复制-replica"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis复制-replica"}},[v._v("#")]),v._v(" Redis复制（replica）")]),v._v(" "),t("h3",{attrs:{id:"_8-1-定义"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-定义"}},[v._v("#")]),v._v(" 8.1 定义")]),v._v(" "),t("blockquote",[t("p",[v._v("主从复制，"),t("code",[v._v("master")]),v._v("以写为主，"),t("code",[v._v("slave")]),v._v("以读为主。")]),v._v(" "),t("p",[v._v("当"),t("code",[v._v("master")]),v._v("数据变化的时候，自动将新的数据异步同步到其他"),t("code",[v._v("slave")]),v._v("数据库。")])]),v._v(" "),t("h3",{attrs:{id:"_8-2-基本命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-基本命令"}},[v._v("#")]),v._v(" 8.2 基本命令")]),v._v(" "),t("table",[t("thead",[t("tr",[t("th",[v._v("命令")]),v._v(" "),t("th",[v._v("解析")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[t("code",[v._v("info replication")])]),v._v(" "),t("td",[v._v("可以查看复制节点的主从关系和配置信息")])]),v._v(" "),t("tr",[t("td",[t("code",[v._v("replicaof 主库IP 主库端口")])]),v._v(" "),t("td",[v._v("一般写入"),t("code",[v._v("redis.conf")]),v._v("配置文件内。")])]),v._v(" "),t("tr",[t("td",[t("code",[v._v("slaveof 主库IP 主库端口")])]),v._v(" "),t("td",[v._v("每次与master断开之后，都需要重新连接，除非配置进"),t("code",[v._v("redis.conf")]),v._v("文件，在运行期间修改"),t("code",[v._v("slave")]),v._v("节点的信息，如果该数据库已经是某个主数据库的从数据库，那么会停止和主数据库的同步关系转而和新的主数据库同步，重新拜码头。")])]),v._v(" "),t("tr",[t("td",[t("code",[v._v("slaveof no one")])]),v._v(" "),t("td",[v._v("使当前数据库停止与其他数据库的同步，转成主数据库，自立为王。")])])])]),v._v(" "),t("h3",{attrs:{id:"_8-3-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-配置"}},[v._v("#")]),v._v(" 8.3 配置")]),v._v(" "),t("blockquote",[t("ol",[t("li",[v._v("开启"),t("code",[v._v("daemonize yes")]),v._v("；")]),v._v(" "),t("li",[v._v("注释掉"),t("code",[v._v("bind 127.0.0.1")]),v._v("；")]),v._v(" "),t("li",[t("code",[v._v("protected-mode no")]),v._v("；")]),v._v(" "),t("li",[v._v("指定端口；")]),v._v(" "),t("li",[v._v("指定当前工作目录，"),t("code",[v._v("dir")]),v._v("；")]),v._v(" "),t("li",[t("code",[v._v("pid")]),v._v("文件名字，"),t("code",[v._v("pidfile")]),v._v("；")]),v._v(" "),t("li",[t("code",[v._v("log")]),v._v("文件名字，"),t("code",[v._v("logfile")]),v._v("；")]),v._v(" "),t("li",[t("code",[v._v("requirepass")]),v._v("；")]),v._v(" "),t("li",[t("code",[v._v("dump.rdb")]),v._v("名字；")]),v._v(" "),t("li",[t("code",[v._v("aof")]),v._v("文件，"),t("code",[v._v("appendfilename")])]),v._v(" "),t("li",[v._v("从机访问主机的通行密码"),t("code",[v._v("masterauth")]),v._v("，必须。")])])]),v._v(" "),t("h3",{attrs:{id:"_8-4-主从问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-4-主从问题"}},[v._v("#")]),v._v(" 8.4 主从问题")]),v._v(" "),t("blockquote",[t("p",[t("strong",[v._v("Q：从机可以执行写命令吗？")])]),v._v(" "),t("p",[v._v("A：不可以，从机只能读。")])]),v._v(" "),t("p",[t("img",{attrs:{src:_(597),alt:"image-20230425165245830"}})]),v._v(" "),t("blockquote",[t("p",[t("strong",[v._v("Q：从机切入点问题？")])]),v._v(" "),t("p",[v._v("A：首次一锅端，后续跟随，master写，slave跟。")]),v._v(" "),t("p",[t("strong",[v._v("Q：主机shutdown后，从机会上位吗")])]),v._v(" "),t("p",[v._v("A：从机不动，原地待命，从机数据可以正常使用，等待主机重启归来。")])]),v._v(" "),t("p",[t("img",{attrs:{src:_(598),alt:"image-20230425170210158"}})]),v._v(" "),t("blockquote",[t("p",[t("strong",[v._v("Q：主机shutdown后，重启后主从关系还在吗？从机还能否顺利复制？")])]),v._v(" "),t("p",[v._v("A：主从关系依然存在，从机依旧是从机，可以顺利复制。")]),v._v(" "),t("p",[t("strong",[v._v("Q：某台从机down后，master继续，从机重启后他能跟上大部队吗？")])]),v._v(" "),t("p",[v._v("A：可以，类似于从机切入点问题。")])]),v._v(" "),t("h3",{attrs:{id:"_8-5-命令操作手动主从关系指令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-5-命令操作手动主从关系指令"}},[v._v("#")]),v._v(" 8.5 命令操作手动主从关系指令")]),v._v(" "),t("blockquote",[t("ol",[t("li",[v._v("从机停机去掉配置文件中的配置项，3台目前都是主机状态，各不从属。")])])]),v._v(" "),t("p",[t("img",{attrs:{src:_(599),alt:"image-20230425170841316"}})]),v._v(" "),t("blockquote",[t("ol",{attrs:{start:"2"}},[t("li",[v._v("3台master")]),v._v(" "),t("li",[v._v("预设的从机上执行命令："),t("code",[v._v("salveof 主库IP 主库端口")])])])]),v._v(" "),t("p",[t("img",{attrs:{src:_(600),alt:"image-20230425171022238"}})]),v._v(" "),t("blockquote",[t("p",[v._v("用命令使用的话，2台从机重启后，关系还在吗？")]),v._v(" "),t("p",[v._v("不会存在了。")]),v._v(" "),t("p",[t("strong",[v._v("配置VS命令的区别，配置：持久稳定永久生效；命令：当前生效。")])])]),v._v(" "),t("h3",{attrs:{id:"_8-6-薪火相传"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-6-薪火相传"}},[v._v("#")]),v._v(" 8.6 薪火相传")]),v._v(" "),t("blockquote",[t("ul",[t("li",[v._v("上一个"),t("code",[v._v("slave")]),v._v("可以是下一个"),t("code",[v._v("slave")]),v._v("的"),t("code",[v._v("master")]),v._v("，"),t("code",[v._v("slave")]),v._v("同样可以接收其他"),t("code",[v._v("slave")]),v._v("的连接和同步请求，那么该"),t("code",[v._v("slave")]),v._v("作为了链条中下一个的"),t("code",[v._v("master")]),v._v("，可以有效减轻注"),t("code",[v._v("master")]),v._v("的写压力。")]),v._v(" "),t("li",[v._v("中途变更转向，会清除之前的数据，重新建立主从关系并拷贝最新的。")]),v._v(" "),t("li",[t("code",[v._v("slaveof 新主库IP 新主库端口")])])])]),v._v(" "),t("h3",{attrs:{id:"_8-7-反客为主"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-7-反客为主"}},[v._v("#")]),v._v(" 8.7 反客为主")]),v._v(" "),t("blockquote",[t("p",[t("code",[v._v("slaveof on one")]),v._v("使当前数据库停止与其他数据库的同步关系。")])]),v._v(" "),t("h3",{attrs:{id:"_8-8-复制原理和工作流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-8-复制原理和工作流程"}},[v._v("#")]),v._v(" 8.8 复制原理和工作流程")]),v._v(" "),t("blockquote",[t("p",[t("strong",[t("code",[v._v("slave")]),v._v("启动，同步初请")]),v._v("：")]),v._v(" "),t("p",[v._v("---\x3e"),t("code",[v._v("slave")]),v._v("启动成功连接到"),t("code",[v._v("master")]),v._v("后会发送一个同步（sync）命令。")]),v._v(" "),t("p",[v._v("---\x3e"),t("code",[v._v("slave")]),v._v("首次全新连接"),t("code",[v._v("master")]),v._v("，一次完全同步（全量复制）将被自动执行，"),t("code",[v._v("salve")]),v._v("自身原有数据会被"),t("code",[v._v("master")]),v._v("数据覆盖清除。")]),v._v(" "),t("p",[t("strong",[v._v("首次连接，全量复制：")])]),v._v(" "),t("p",[v._v("---\x3e"),t("code",[v._v("master")]),v._v("节点收到"),t("code",[v._v("sync")]),v._v("命令后会开始在后台保存快照(即"),t("code",[v._v("RDB")]),v._v("持久化，主从复制时会触发"),t("code",[v._v("RDB")]),v._v(")，同时收集所有接收到的用于修改数据集的命令并缓存起来，"),t("code",[v._v("master")]),v._v("节点执行"),t("code",[v._v("RDB")]),v._v("持久化完后，"),t("code",[v._v("master")]),v._v("将"),t("code",[v._v("RDB")]),v._v("快照文件和所有缓存的命令发送到所有"),t("code",[v._v("slave")]),v._v("，以完成一次完全同步。")]),v._v(" "),t("p",[v._v("---\x3e而"),t("code",[v._v("slave")]),v._v("服务在接收到数据库文件数据后，将其存盘并加载到内存中，从而完成复制初始化。")]),v._v(" "),t("p",[t("strong",[v._v("心跳持续，保持通信：")])]),v._v(" "),t("p",[v._v("---\x3e"),t("code",[v._v("repl-ping-replica-period 10")])])]),v._v(" "),t("p",[t("img",{attrs:{src:_(601),alt:"image-20230425174515841"}})]),v._v(" "),t("blockquote",[t("p",[t("strong",[v._v("进入平稳，增量复制：")])]),v._v(" "),t("p",[v._v("---\x3e"),t("code",[v._v("master")]),v._v("继续将新的所有收集到的修改命令自动一次传给"),t("code",[v._v("slave")]),v._v("，完成同步。")]),v._v(" "),t("p",[t("strong",[v._v("从机下线，重连续传：")])]),v._v(" "),t("p",[v._v("---\x3e"),t("code",[v._v("master")]),v._v("会检查"),t("code",[v._v("backlog")]),v._v("里面的"),t("code",[v._v("offset")]),v._v("，"),t("code",[v._v("master")]),v._v("和"),t("code",[v._v("slave")]),v._v("都会保存一个复制的"),t("code",[v._v("offset")]),v._v("还有一个"),t("code",[v._v("masterId")]),v._v("，"),t("code",[v._v("offset")]),v._v("是保存在"),t("code",[v._v("backlog")]),v._v("中的。"),t("code",[v._v("master")]),v._v("只会把已经缓存的"),t("code",[v._v("offset")]),v._v("后面的数据复制给"),t("code",[v._v("slave")]),v._v("，类似断点续传。")])]),v._v(" "),t("h3",{attrs:{id:"_8-9-复制的缺点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-9-复制的缺点"}},[v._v("#")]),v._v(" 8.9 复制的缺点")]),v._v(" "),t("blockquote",[t("p",[t("strong",[v._v("复制延时，信号衰减")])]),v._v(" "),t("p",[v._v("由于所有的写操作都是先在"),t("code",[v._v("master")]),v._v("上操作，然后同步更新到"),t("code",[v._v("slave")]),v._v("上，所以从"),t("code",[v._v("master")]),v._v("同步到"),t("code",[v._v("slave")]),v._v("机器有一定的延迟，当系统很繁忙的时候，延迟问题会更加严重，"),t("code",[v._v("slave")]),v._v("机器数量的增加也会使这个问题更加严重。")])]),v._v(" "),t("p",[t("img",{attrs:{src:_(602),alt:"image-20230425175421775"}})]),v._v(" "),t("blockquote",[t("p",[v._v("默认情况下，不会在"),t("code",[v._v("slave")]),v._v("节点中自动重选一个"),t("code",[v._v("master")]),v._v("。")])])])}),[],!1,null,null,null);e.default=a.exports},597:function(v,e){v.exports="data:image/png;base64,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"},598:function(v,e,_){v.exports=_.p+"assets/img/image-20230425170210158.fc8f04bd.png"},599:function(v,e,_){v.exports=_.p+"assets/img/image-20230425170841316.6a67e5b8.png"},600:function(v,e,_){v.exports=_.p+"assets/img/image-20230425171022238.9595e006.png"},601:function(v,e,_){v.exports=_.p+"assets/img/image-20230425174515841.4026d80b.png"},602:function(v,e,_){v.exports=_.p+"assets/img/image-20230425175421775.df05f3a2.png"}}]);