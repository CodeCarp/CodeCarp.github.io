(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1086:function(s,t,a){"use strict";a.r(t);var e=a(27),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"索引失效的场景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#索引失效的场景"}},[s._v("#")]),s._v(" 索引失效的场景")]),s._v(" "),e("blockquote",[e("p",[s._v("原文链接：https://blog.csdn.net/lisu061714112/article/details/122398894")]),s._v(" "),e("p",[s._v("今天就跟大家一起聊聊，mysql数据库索引失效的10种场景，给曾经踩过坑，或者即将要踩坑的朋友们一个参考。")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(880),alt:"image-20230817112905760"}})]),s._v(" "),e("h2",{attrs:{id:"_1-准备工作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-准备工作"}},[s._v("#")]),s._v(" 1. 准备工作")]),s._v(" "),e("blockquote",[e("p",[s._v("所谓空口无凭，如果我直接把索引失效的这些场景丢出来，可能没有任何说服力。")]),s._v(" "),e("p",[s._v("所以，我决定建表和造数据，给大家一步步演示效果，尽量做到有理有据。")]),s._v(" "),e("p",[s._v("我相信，如果大家耐心的看完这篇文章，一定会有很多收获的。")])]),s._v(" "),e("h3",{attrs:{id:"_1-1-创建user表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-创建user表"}},[s._v("#")]),s._v(" 1.1 创建user表")]),s._v(" "),e("blockquote",[e("p",[s._v("创建一张user表，表中包含：id、code、age、name和height字段。")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("code"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COLLATE")]),s._v(" utf8mb4_bin "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("age"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COLLATE")]),s._v(" utf8mb4_bin "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("height"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("address"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COLLATE")]),s._v(" utf8mb4_bin "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("idx_code_age_name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("code"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("age"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("idx_height"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("height"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARSET")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8mb4 "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COLLATE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8mb4_bin\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("blockquote",[e("p",[s._v("此外，还创建了三个索引：")]),s._v(" "),e("ul",[e("li",[e("font",{staticStyle:{color:"orange","font-weight":"600"}},[e("code",[s._v("id")])]),s._v("： 数据库的主键")],1),s._v(" "),e("li",[e("font",{staticStyle:{color:"orange","font-weight":"600"}},[e("code",[s._v("idx_code_age_name")])]),s._v("： 由"),e("code",[s._v("code")]),s._v("、"),e("code",[s._v("age")]),s._v("和"),e("code",[s._v("name")]),s._v("三个字段组成的联合索引。")],1),s._v(" "),e("li",[e("font",{staticStyle:{color:"orange","font-weight":"600"}},[e("code",[s._v("idx_height")])]),s._v("：普通索引")],1)])]),s._v(" "),e("h3",{attrs:{id:"_1-2-插入数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-插入数据"}},[s._v("#")]),s._v(" 1.2 插入数据")]),s._v(" "),e("blockquote",[e("p",[s._v("为了方便给大家做演示，我特意向user表中插入了3条数据：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" sue"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" code"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" age"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" height"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'101'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'周星驰'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("175")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'香港'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" sue"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" code"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" age"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" height"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'102'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'周杰伦'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("173")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'台湾'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" sue"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" code"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" age"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" height"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'103'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'苏三'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("174")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'成都'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"_1-3-查看数据库版本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-查看数据库版本"}},[s._v("#")]),s._v(" 1.3 查看数据库版本")]),s._v(" "),e("blockquote",[e("p",[s._v("为了防止以后出现不必要的误会，在这里有必要查一下当前数据库的版本。")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" version"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查出当前的mysql版本号为：8.0.21")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"_1-4-查看执行计划"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-查看执行计划"}},[s._v("#")]),s._v(" 1.4 查看执行计划")]),s._v(" "),e("blockquote",[e("p",[s._v("在mysql中，如果你想查看某条sql语句是否使用了索引，或者已建好的索引是否失效，可以通过explain关键字，查看该sql语句的执行计划，来判断索引使用情况。")])]),s._v(" "),e("p",[s._v("例如：")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("执行结果：")]),s._v(" "),e("p",[e("img",{attrs:{src:a(881),alt:"image-20230817113435842"}})]),s._v(" "),e("blockquote",[e("p",[s._v("从图中可以看出，由于id字段是主键，该sql语句用到了主键索引。")])]),s._v(" "),e("h2",{attrs:{id:"_2-不满足最左匹配原则"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-不满足最左匹配原则"}},[s._v("#")]),s._v(" 2.不满足最左匹配原则")]),s._v(" "),e("blockquote",[e("p",[s._v("之前已经给code、age和name这3个字段建好联合索引：idx_code_age_name。")]),s._v(" "),e("p",[s._v("该索引字段的顺序是：")]),s._v(" "),e("ul",[e("li",[s._v("code")]),s._v(" "),e("li",[s._v("age")]),s._v(" "),e("li",[s._v("name")])]),s._v(" "),e("p",[s._v("如果在使用联合索引时，没注意最左前缀原则，很有可能导致索引失效喔，不信我们一起往下看。")])]),s._v(" "),e("h3",{attrs:{id:"_2-1-哪些情况索引有效"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-哪些情况索引有效"}},[s._v("#")]),s._v(" 2.1 哪些情况索引有效？")]),s._v(" "),e("blockquote",[e("p",[s._v("先看看哪些情况下，能走索引。")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" code"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'101'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" code"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'101'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" age"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" code"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'101'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" age"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'周星驰'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("执行结果：")]),s._v(" "),e("p",[e("img",{attrs:{src:a(882),alt:"image-20230817113730881"}})]),s._v(" "),e("blockquote",[e("p",[s._v("上面三种情况，"),e("code",[s._v("sql")]),s._v("都能正常走索引。")]),s._v(" "),e("p",[s._v("其实还有一种比较特殊的场景：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" code "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'101'")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'周星驰'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("执行结果：")]),s._v(" "),e("p",[e("img",{attrs:{src:a(883),alt:"image-20230817113828313"}})]),s._v(" "),e("blockquote",[e("p",[s._v("查询条件原本的顺序是：code、age、name，但这里只有code和name中间断层了，掉了age字段，这种情况也能走code字段上的索引。")]),s._v(" "),e("p",[e("strong",[s._v("发现这样一个规律：")]),s._v(" "),e("font",{staticStyle:{color:"red","font-weight":"600"}},[s._v("这4条sql中都有code字段，它是索引字段中的第一个字段，也就是最左边的字段。只要有这个字段在，该sql已经就能走索引。  ")]),s._v("这就是我们所说的最左匹配原则。")],1)]),s._v(" "),e("h3",{attrs:{id:"_2-2-哪些情况索引失效"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-哪些情况索引失效"}},[s._v("#")]),s._v(" 2.2 哪些情况索引失效？")]),s._v(" "),e("blockquote",[e("p",[s._v("前面已经介绍过，建立了联合索引后，在查询条件中有哪些情况索引是有效的。")]),s._v(" "),e("p",[s._v("接下来，我们重点看看哪些情况下索引会失效。")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" age"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'周星驰'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" age"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'周星驰'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(884),alt:"image-20230817140358412"}})]),s._v(" "),e("blockquote",[e("p",[s._v("从图中看出这3种情况下索引确实失效了。")]),s._v(" "),e("p",[s._v("说明以上3种情况不满足最左匹配原则，说白了是"),e("font",{staticStyle:{color:"orange","font-weight":"600"}},[s._v(" 因为查询条件中，没有包含给定字段最左边的索引字段， ")]),s._v("即字段code。")],1)]),s._v(" "),e("h2",{attrs:{id:"_3-使用了select"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-使用了select"}},[s._v("#")]),s._v(" 3. 使用了select *")]),s._v(" "),e("blockquote",[e("p",[s._v("在《阿里巴巴开发手册》中明确说过，查询"),e("code",[s._v("sql")]),s._v("中禁止使用select * 。")]),s._v(" "),e("p",[s._v("先上一条"),e("code",[s._v("sql")]),s._v("：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" \n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'苏三'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(885),alt:"image-20230817140703650"}})]),s._v(" "),e("blockquote",[e("p",[s._v("在该"),e("code",[s._v("sql")]),s._v("中用了"),e("code",[s._v("select *")]),s._v("，从执行结果看，走了全表扫描，没有用到任何索引，查询效率是非常低的。")]),s._v(" "),e("p",[s._v("如果查询的时候，只查我们真正需要的列，而不查所有列，结果会怎么样？")]),s._v(" "),e("p",[s._v("非常快速的将上面的"),e("code",[s._v("sql")]),s._v("改成只查了"),e("code",[s._v("code")]),s._v("和"),e("code",[s._v("name")]),s._v("列，太"),e("code",[s._v("easy")]),s._v("了：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" \n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" code"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" \n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'苏三'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(886),alt:"image-20230817140839240"}})]),s._v(" "),e("blockquote",[e("p",[s._v("从图中执行结果不难看出，该"),e("code",[s._v("sql")]),s._v("语句这次走了全索引扫描，比全表扫描效率更高。")]),s._v(" "),e("p",[s._v("其实这里用到了：覆盖索引。")]),s._v(" "),e("p",[s._v("如果"),e("code",[s._v("select")]),s._v("语句中的查询列，都是索引列，那么这些列被称为覆盖索引。这种情况下，查询的相关字段都能走索引，索引查询效率相对来说更高一些。")]),s._v(" "),e("p",[s._v("而使用"),e("code",[s._v("select *")]),s._v("查询所有列的数据，大概率会查询非索引列的数据，非索引列不会走索引，查询效率非常低。")])]),s._v(" "),e("h2",{attrs:{id:"_4-索引列上有计算"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-索引列上有计算"}},[s._v("#")]),s._v(" 4. 索引列上有计算")]),s._v(" "),e("blockquote",[e("p",[s._v("介绍本章节内容前，先跟大家一起回顾一下，根据id查询数据的"),e("code",[s._v("sql")]),s._v("语句：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(887),alt:"image-20230817141408396"}})]),s._v(" "),e("blockquote",[e("p",[s._v("从图中可以看出，由于id字段是主键，该"),e("code",[s._v("sql")]),s._v("语句用到了主键索引。")]),s._v(" "),e("p",[s._v("但如果id列上面有计算，比如：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("执行结果：")]),s._v(" "),e("p",[e("img",{attrs:{src:a(888),alt:"image-20230817141452855"}})]),s._v(" "),e("blockquote",[e("p",[s._v("从上图中的执行结果，能够非常清楚的看出，该id字段的主键索引，在有计算的情况下失效了。")])]),s._v(" "),e("h2",{attrs:{id:"_5-索引列用了函数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-索引列用了函数"}},[s._v("#")]),s._v(" 5. 索引列用了函数")]),s._v(" "),e("blockquote",[e("p",[s._v("有时候我们在某条"),e("code",[s._v("sql")]),s._v("语句的查询条件中，需要使用函数，比如：截取某个字段的长度。")]),s._v(" "),e("p",[s._v("假如现在有个需求：想查出所有身高是17开头的人，如果"),e("code",[s._v("sql")]),s._v("语句写成这样：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" height"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("该"),e("code",[s._v("sql")]),s._v("语句确实用到了普通索引：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(889),alt:"image-20230817141940739"}})]),s._v(" "),e("blockquote",[e("p",[s._v("但该"),e("code",[s._v("sql")]),s._v("语句肯定是有问题的，因为它只能查出身高正好等于17的，但对于174这种情况，它没办法查出来。")]),s._v(" "),e("p",[s._v("为了满足上面的要求，需要把"),e("code",[s._v("sql")]),s._v("语句稍稍改造了一下：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" SUBSTR"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("height"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("这时需要用到"),e("code",[s._v("SUBSTR")]),s._v("函数，用它截取了"),e("code",[s._v("height")]),s._v("字段的前面两位字符，从第一个字符开始。")]),s._v(" "),e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(890),alt:"image-20230817142050813"}})]),s._v(" "),e("blockquote",[e("p",[s._v("你有没有发现，在使用该函数之后，该"),e("code",[s._v("sql")]),s._v("语句竟然走了全表扫描，索引失效了。")])]),s._v(" "),e("h2",{attrs:{id:"_6-字段类型不同"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-字段类型不同"}},[s._v("#")]),s._v(" 6. 字段类型不同")]),s._v(" "),e("blockquote",[e("p",[s._v("在"),e("code",[s._v("sql")]),s._v("语句中因为字段类型不同，而导致索引失效的问题，很容易遇到，可能是我们日常工作中最容易忽略的问题。")]),s._v(" "),e("p",[s._v("注意观察一下"),e("code",[s._v("t_user")]),s._v("表中的"),e("code",[s._v("code")]),s._v("字段，它是"),e("code",[s._v("varchar")]),s._v("字符类型的。")]),s._v(" "),e("p",[s._v("在"),e("code",[s._v("sql")]),s._v("句中查询数据时，查询条件我们可以写成这样：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" \n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" code"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"101"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(891),alt:"image-20230817142340789"}})]),s._v(" "),e("blockquote",[e("p",[s._v("从上图中看到，该code字段走了索引。")])]),s._v(" "),e("p",[e("font",{staticStyle:{color:"orange","font-weight":"600"}},[s._v("温馨提醒：查询字符字段时，用双引号“和单引号'都可以。  ")])],1),s._v(" "),e("blockquote",[e("p",[s._v("但如果在写"),e("code",[s._v("sql")]),s._v("时，不小心把引号弄掉了，把"),e("code",[s._v("sql")]),s._v("语句变成了：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" \n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" code"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(892),alt:"image-20230817142459193"}})]),s._v(" "),e("blockquote",[e("p",[s._v("该"),e("code",[s._v("sql")]),s._v("语句变成了全表扫描。因为少写了引号，这种小小的失误，竟然让code字段上的索引失效了。")]),s._v(" "),e("p",[s._v("这时你心里可能有一万个为什么，其中有一个肯定是：为什么索引会失效呢？")]),s._v(" "),e("p",[e("strong",[s._v("答：")]),e("font",{staticStyle:{color:"blue","font-weight":"600"}},[s._v("因为code字段的类型是"),e("code",[s._v("varchar")]),s._v("，而传参的类型是int，两种类型不同。 ")])],1),s._v(" "),e("p",[s._v("此外，还有一个有趣的现象，如果int类型的height字段，在查询时加了引号条件，却还可以走索引：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" \n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" height"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'175'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("执行结果：")]),s._v(" "),e("p",[e("img",{attrs:{src:a(893),alt:"image-20230817142639568"}})]),s._v(" "),e("blockquote",[e("p",[s._v("从图中看出该sql语句确实走了索引。int类型的参数，不管在查询时加没加引号，都能走索引。")]),s._v(" "),e("p",[s._v("这是变魔术吗？这不科学呀。")]),s._v(" "),e("p",[e("strong",[s._v("答：")]),e("font",{staticStyle:{color:"blue","font-weight":"600"}},[s._v(" mysql发现如果是int类型字段作为查询条件时，它会自动将该字段的传参进行隐式转换，把字符串转换成int类型。 ")])],1),s._v(" "),e("p",[s._v("mysql会把上面列子中的字符串175，转换成数字175，所以仍然能走索引。")]),s._v(" "),e("p",[s._v("接下来，看一个更有趣的"),e("code",[s._v("sql")]),s._v("语句：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("它的执行结果是2，还是11呢？")]),s._v(" "),e("p",[s._v("好吧，不卖关子了，直接公布答案执行结果是2。")]),s._v(" "),e("p",[s._v("mysql自动把字符串1，转换成了int类型的1，然后变成了：1+1=2。")]),s._v(" "),e("p",[s._v("但如果你确实想拼接字符串该怎么办？")]),s._v(" "),e("p",[s._v("**答：**可以使用"),e("code",[s._v("concat")]),s._v("关键字。")]),s._v(" "),e("p",[s._v("具体拼接"),e("code",[s._v("sql")]),s._v("如下：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" concat"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[e("strong",[s._v("接下来，关键问题来了：为什么字符串类型的字段，传入了int类型的参数时索引会失效呢？")])]),s._v(" "),e("p",[s._v("**答：**根据mysql官网上解释，字符串’1’、’ 1 '、'1a’都能转换成int类型的1，也就是说可能会出现多个字符串，对应一个int类型参数的情况。那么，mysql怎么知道该把int类型的1转换成哪种字符串，用哪个索引快速查值?感兴趣的小伙伴可以再看看官方文档：https://dev.mysql.com/doc/refman/8.0/en/type-conversion.html")])]),s._v(" "),e("h2",{attrs:{id:"_7-like左边包含"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-like左边包含"}},[s._v("#")]),s._v(" 7. like左边包含%")]),s._v(" "),e("blockquote",[e("p",[s._v("模糊查询，在我们日常的工作中，使用频率还是比较高的。")]),s._v(" "),e("p",[s._v("比如现在有个需求：想查询姓李的同学有哪些?")]),s._v(" "),e("p",[s._v("使用like语句可以很快的实现：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'李%'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("但如果like用的不好，就可能会出现性能问题，因为有时候它的索引会失效。")]),s._v(" "),e("p",[s._v("不信，我们一起往下看。")]),s._v(" "),e("p",[e("strong",[s._v("目前like查询主要有三种情况：")])]),s._v(" "),e("ul",[e("li",[s._v("like ‘%a’")]),s._v(" "),e("li",[s._v("like ‘a%’")]),s._v(" "),e("li",[s._v("like ‘%a%’")])]),s._v(" "),e("p",[s._v("假如现在有个需求：想查出所有code是10开头的用户。")]),s._v(" "),e("p",[s._v("这个需求太简单了吧，"),e("code",[s._v("sql")]),s._v("语句如下：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" code "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10%'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("执行结果：")]),s._v(" "),e("p",[e("img",{attrs:{src:a(894),alt:"image-20230817143058475"}})]),s._v(" "),e("blockquote",[e("p",[s._v("图中看出这种%在10右边时走了索引。")]),s._v(" "),e("p",[s._v("而如果把需求改了：想出现出所有code是1结尾的用户。")]),s._v(" "),e("p",[s._v("查询"),e("code",[s._v("sql")]),s._v("语句改为：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" code "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%1'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("执行结果：")]),s._v(" "),e("p",[e("img",{attrs:{src:a(895),alt:"image-20230817143234136"}})]),s._v(" "),e("blockquote",[e("p",[s._v("从图中看出这种%在1左边时，code字段上索引失效了，该sql变成了全表扫描。")]),s._v(" "),e("p",[s._v("此外，如果出现以下"),e("code",[s._v("sql")]),s._v("：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" code "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%1%'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("该"),e("code",[s._v("sql")]),s._v("语句的索引也会失效。")]),s._v(" "),e("p",[s._v("下面用一句话总结一下规律："),e("font",{staticStyle:{color:"red","font-weight":"600"}},[s._v(" 当like语句中的%，出现在查询条件的左边时，索引会失效。 ")])],1),s._v(" "),e("p",[s._v("那么，为什么会出现这种现象呢？")]),s._v(" "),e("p",[s._v("**答：**其实很好理解，"),e("font",{staticStyle:{color:"orange","font-weight":"600"}},[s._v(" 索引就像字典中的目录。一般目录是按字母或者拼音从小到大，从左到右排序，是有顺序的。 ")])],1),s._v(" "),e("p",[s._v("我们在查目录时，通常会先从左边第一个字母进行匹对，如果相同，再匹对左边第二个字母，如果再相同匹对其他的字母，以此类推。")]),s._v(" "),e("p",[s._v("通过这种方式我们能快速锁定一个具体的目录，或者缩小目录的范围。")]),s._v(" "),e("p",[s._v("但如果你硬要跟目录的设计反着来，先从字典目录右边匹配第一个字母，这画面你可以自行脑补一下，你眼中可能只剩下绝望了，哈哈。")])]),s._v(" "),e("h2",{attrs:{id:"_8-列对比"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-列对比"}},[s._v("#")]),s._v(" 8. 列对比")]),s._v(" "),e("blockquote",[e("p",[s._v("上面的内容都是常规需求，接下来，来点不一样的。")]),s._v(" "),e("p",[s._v("假如我们现在有这样一个需求：过滤出表中某两列值相同的记录。比如user表中id字段和height字段，查询出这两个字段中值相同的记录。")]),s._v(" "),e("p",[s._v("这个需求很简单，"),e("code",[s._v("sql")]),s._v("可以这样写：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" \n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("height\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(896),alt:"img"}})]),s._v(" "),e("blockquote",[e("p",[s._v("意不意外，惊不惊喜？索引失效了。")]),s._v(" "),e("p",[s._v("为什么会出现这种结果？")]),s._v(" "),e("p",[s._v("id字段本身是有主键索引的，同时height字段也建了普通索引的，并且两个字段都是int类型，类型是一样的。")]),s._v(" "),e("p",[s._v("但如果把两个单独建了索引的列，用来做列对比时索引会失效。")])]),s._v(" "),e("h2",{attrs:{id:"_9-使用or关键字"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_9-使用or关键字"}},[s._v("#")]),s._v(" 9. 使用or关键字")]),s._v(" "),e("blockquote",[e("p",[s._v("我们平时在写查询"),e("code",[s._v("sql")]),s._v("时，使用or关键字的场景非常多，但如果你稍不注意，就可能让已有的索引失效。")]),s._v(" "),e("p",[s._v("不信一起往下面看。")]),s._v(" "),e("p",[s._v("某天你遇到这样一个需求：想查一下id=1或者height=175的用户。")]),s._v(" "),e("p",[s._v("你三下五除二就把"),e("code",[s._v("sql")]),s._v("写好了：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" \n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("or")]),s._v(" height"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'175'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(897),alt:"img"}})]),s._v(" "),e("blockquote",[e("p",[s._v("没错，这次确实走了索引，恭喜被你蒙对了，因为刚好id和height字段都建了索引。")]),s._v(" "),e("p",[s._v("但接下来的一个夜黑风高的晚上，需求改了：除了前面的查询条件之后，还想加一个address=‘成都’。")]),s._v(" "),e("p",[s._v("这还不简单，"),e("code",[s._v("sql")]),s._v("走起：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" \n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("or")]),s._v(" height"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'175'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("or")]),s._v(" address"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'成都'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(898),alt:"img"}})]),s._v(" "),e("blockquote",[e("p",[s._v("结果悲剧了，之前的索引都失效了。")]),s._v(" "),e("p",[s._v("你可能一脸懵逼，为什么？我做了什么？")]),s._v(" "),e("p",[e("strong",[s._v("答：因为你最后加的address字段没有加索引，从而导致其他字段的索引都失效了。")])])]),s._v(" "),e("p",[e("font",{staticStyle:{color:"orange","font-weight":"600"}},[s._v("注意：如果使用了or关键字，那么它前面和后面的字段都要加索引，不然所有的索引都会失效，这是一个大坑。  ")])],1),s._v(" "),e("h2",{attrs:{id:"_10-not-in和not-exists"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_10-not-in和not-exists"}},[s._v("#")]),s._v(" 10. not in和not exists")]),s._v(" "),e("blockquote",[e("p",[s._v("在我们日常工作中用得也比较多的，还有范围查询，常见的有：")]),s._v(" "),e("ul",[e("li",[s._v("in")]),s._v(" "),e("li",[s._v("exists")]),s._v(" "),e("li",[s._v("not in")]),s._v(" "),e("li",[s._v("not exists")]),s._v(" "),e("li",[s._v("between and")])]),s._v(" "),e("p",[s._v("今天重点聊聊前面四种。")])]),s._v(" "),e("h3",{attrs:{id:"_10-1-in关键字"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-in关键字"}},[s._v("#")]),s._v(" 10.1 in关键字")]),s._v(" "),e("blockquote",[e("p",[s._v("假如我们想查出height在某些范围之内的用户，这时"),e("code",[s._v("sql")]),s._v("语句可以这样写：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" height "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("173")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("174")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("175")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("176")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(899),alt:"img"}})]),s._v(" "),e("blockquote",[e("p",[s._v("从图中可以看出，sql语句中用in关键字是走了索引的。")])]),s._v(" "),e("h3",{attrs:{id:"_10-2-exists关键字"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_10-2-exists关键字"}},[s._v("#")]),s._v(" 10.2 exists关键字")]),s._v(" "),e("blockquote",[e("p",[s._v("有时候使用in关键字时性能不好，这时就能用exists关键字优化"),e("code",[s._v("sql")]),s._v("了，该关键字能达到in关键字相同的效果：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("  t1\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exists")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" t2 "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" t2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("height"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("173")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" t1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("t2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(900),alt:"img"}})]),s._v(" "),e("blockquote",[e("p",[s._v("从图中可以看出，用exists关键字同样走了索引。")])]),s._v(" "),e("h3",{attrs:{id:"_10-3-not-in关键字"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_10-3-not-in关键字"}},[s._v("#")]),s._v(" 10.3 not in关键字")]),s._v(" "),e("blockquote",[e("p",[s._v("上面演示的两个例子是正向的范围，即在某些范围之内。")]),s._v(" "),e("p",[s._v("那么反向的范围，即不在某些范围之内，能走索引不？")]),s._v(" "),e("p",[s._v("话不多说，先看看使用not in的情况：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" height "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("173")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("174")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("175")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("176")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(901),alt:"img"}})]),s._v(" "),e("blockquote",[e("p",[s._v("你没看错，索引失效了。")]),s._v(" "),e("p",[s._v("看如果现在需求改了：想查一下id不等于1、2、3的用户有哪些，这时"),e("code",[s._v("sql")]),s._v("语句可以改成这样：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("173")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("174")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("175")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("176")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(902),alt:"img"}})]),s._v(" "),e("blockquote",[e("p",[s._v("你可能会惊奇的发现，主键字段中使用not in关键字查询数据范围，任然可以走索引。而普通索引字段使用了not in关键字查询数据范围，索引会失效。")])]),s._v(" "),e("h3",{attrs:{id:"_10-4-not-exists关键字"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_10-4-not-exists关键字"}},[s._v("#")]),s._v(" 10.4 not exists关键字")]),s._v(" "),e("blockquote",[e("p",[s._v("除此之外，如果"),e("code",[s._v("sql")]),s._v("语句中使用"),e("code",[s._v("not exists")]),s._v("时，索引也会失效。具体"),e("code",[s._v("sql")]),s._v("语句如下：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("  t1\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exists")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" t2 "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" t2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("height"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("173")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" t1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("t2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(903),alt:"img"}})]),s._v(" "),e("blockquote",[e("p",[s._v("从图中看出"),e("code",[s._v("sql")]),s._v("语句中使用"),e("code",[s._v("not exists")]),s._v("关键后，"),e("code",[s._v("t1")]),s._v("表走了全表扫描，并没有走索引。")])]),s._v(" "),e("h2",{attrs:{id:"_11-order-by的坑"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_11-order-by的坑"}},[s._v("#")]),s._v(" 11. order by的坑")]),s._v(" "),e("blockquote",[e("p",[s._v("在"),e("code",[s._v("sql")]),s._v("语句中，对查询结果进行排序是非常常见的需求，一般情况下我们用关键字：order by就能搞定。")]),s._v(" "),e("p",[s._v("但我始终觉得order by挺难用的，它跟where或者limit关键字有很多千丝万缕的联系，一不小心就会出问题。Let go")])]),s._v(" "),e("h3",{attrs:{id:"_11-1-哪些情况走索引"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_11-1-哪些情况走索引"}},[s._v("#")]),s._v(" 11.1 哪些情况走索引？")]),s._v(" "),e("blockquote",[e("p",[s._v("首先当然要温柔一点，一起看看order by的哪些情况可以走索引。")]),s._v(" "),e("p",[s._v("我之前说过，在"),e("code",[s._v("code")]),s._v("、"),e("code",[s._v("age")]),s._v("和"),e("code",[s._v("name")]),s._v("这3个字段上，已经建了联合索引："),e("code",[s._v("idx_code_age_name")]),s._v("。")])]),s._v(" "),e("h4",{attrs:{id:"_11-1-1-满足最左匹配原则"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_11-1-1-满足最左匹配原则"}},[s._v("#")]),s._v(" 11.1.1 满足最左匹配原则")]),s._v(" "),e("blockquote",[e("p",[s._v("order by后面的条件，也要遵循联合索引的最左匹配原则。具体有以下"),e("code",[s._v("sql")]),s._v("：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" code "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" code"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("age "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" code"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("age"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(398),alt:"img"}})]),s._v(" "),e("blockquote",[e("p",[s._v("从图中看出这3条sql都能够正常走索引。")]),s._v(" "),e("p",[s._v("除了遵循最左匹配原则之外，"),e("font",{staticStyle:{color:"red","font-weight":"600"}},[s._v("有个非常关键的地方是，后面还是加了limit关键字，如果不加它索引会失效。  ")])],1)]),s._v(" "),e("h4",{attrs:{id:"_11-1-2-配合where一起使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_11-1-2-配合where一起使用"}},[s._v("#")]),s._v(" 11.1.2 配合where一起使用")]),s._v(" "),e("blockquote",[e("p",[s._v("order by还能配合where一起遵循最左匹配原则。")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" code"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'101'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" age"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(398),alt:"img"}})]),s._v(" "),e("blockquote",[e("p",[s._v("code是联合索引的第一个字段，在where中使用了，而age是联合索引的第二个字段，在order by中接着使用。")]),s._v(" "),e("p",[s._v("假如中间断层了，"),e("code",[s._v("sql")]),s._v("语句变成这样，执行结果会是什么呢？")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" code"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'101'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(904),alt:"img"}})]),s._v(" "),e("blockquote",[e("p",[s._v("虽说name是联合索引的第三个字段，但根据最左匹配原则，该"),e("code",[s._v("sql")]),s._v("语句依然能走索引，因为最左边的第一个字段code，在where中使用了。只不过order by的时候，排序效率比较低，需要走一次"),e("code",[s._v("filesort")]),s._v("排序罢了。")])]),s._v(" "),e("h4",{attrs:{id:"_11-1-3-相同的排序"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_11-1-3-相同的排序"}},[s._v("#")]),s._v(" 11.1.3 相同的排序")]),s._v(" "),e("blockquote",[e("p",[s._v("order by后面如果包含了联合索引的多个排序字段，只要它们的排序规律是相同的（要么同时升序，要么同时降序），也可以走索引。")]),s._v(" "),e("p",[s._v("具体"),e("code",[s._v("sql")]),s._v("如下：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" code "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("age "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("执行结果：")]),s._v(" "),e("p",[e("img",{attrs:{src:a(905),alt:"img"}})]),s._v(" "),e("blockquote",[e("p",[s._v("该示例中order by后面的code和age字段都用了降序，所以依然走了索引。")])]),s._v(" "),e("h4",{attrs:{id:"_11-1-4-两者都有"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_11-1-4-两者都有"}},[s._v("#")]),s._v(" 11.1.4 两者都有")]),s._v(" "),e("blockquote",[e("p",[s._v("如果某个联合索引字段，在where和order by中都有，结果会怎么样？")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" code"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'101'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" code"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(906),alt:"img"}})]),s._v(" "),e("blockquote",[e("p",[s._v("code字段在where和order by中都有，对于这种情况，从图中的结果看出，还是能走了索引的。")])]),s._v(" "),e("h3",{attrs:{id:"_11-2-哪些情况不走索引"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-哪些情况不走索引"}},[s._v("#")]),s._v(" 11.2 哪些情况不走索引？")]),s._v(" "),e("blockquote",[e("p",[s._v("前面介绍的都是正面的用法，是为了让大家更容易接受下面反面的用法。")]),s._v(" "),e("p",[s._v("好了，接下来，重点聊聊order by的哪些情况下不走索引？")])]),s._v(" "),e("h4",{attrs:{id:"_11-2-1-没加where或limit"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-1-没加where或limit"}},[s._v("#")]),s._v(" 11.2.1 没加where或limit")]),s._v(" "),e("blockquote",[e("p",[s._v("如果order by语句中没有加where或limit关键字，该sql语句将不会走索引。")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" code"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(907),alt:"img"}})]),s._v(" "),e("blockquote",[e("p",[s._v("从图中看出索引真的失效了。")])]),s._v(" "),e("h4",{attrs:{id:"_11-2-2-对不同的索引做order-by"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-2-对不同的索引做order-by"}},[s._v("#")]),s._v(" 11.2.2 对不同的索引做order by")]),s._v(" "),e("blockquote",[e("p",[s._v("前面介绍的基本都是联合索引，这一个索引的情况。但如果对多个索引进行order by，结果会怎么样呢？")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" code"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" height "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(399),alt:"img"}})]),s._v(" "),e("blockquote",[e("p",[s._v("从图中看出索引也失效了。")])]),s._v(" "),e("h4",{attrs:{id:"_11-2-3-不满足最左匹配原则"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-3-不满足最左匹配原则"}},[s._v("#")]),s._v(" 11.2.3 不满足最左匹配原则")]),s._v(" "),e("blockquote",[e("p",[s._v("前面已经介绍过，order by如果满足最左匹配原则，还是会走索引。下面看看，不满足最左匹配原则的情况：")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" name "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(908),alt:"img"}})]),s._v(" "),e("blockquote",[e("p",[s._v("name字段是联合索引的第三个字段，从图中看出如果order by不满足最左匹配原则，确实不会走索引。")])]),s._v(" "),e("h4",{attrs:{id:"_11-2-4-不同的排序"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-4-不同的排序"}},[s._v("#")]),s._v(" 11.2.4 不同的排序")]),s._v(" "),e("blockquote",[e("p",[s._v("前面已经介绍过，如果order by后面有一个联合索引的多个字段，它们具有相同排序规则，那么会走索引。")]),s._v(" "),e("p",[s._v("但如果它们有不同的排序规则呢？")])]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" code "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("asc")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("age "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("执行结果：")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(399),alt:"img"}})]),s._v(" "),e("blockquote",[e("p",[s._v("从图中看出，尽管order by后面的code和age字段遵循了最左匹配原则，但由于一个字段是用的升序，另一个字段用的降序，最终会导致索引失效。")])])])}),[],!1,null,null,null);t.default=r.exports},398:function(s,t,a){s.exports=a.p+"assets/img/c619d87f7c32045f1782d101ebee30b2.beb891f3.png"},399:function(s,t,a){s.exports=a.p+"assets/img/8e22befb4c743c1790f7eb65aa804b44.4f3e882b.png"},880:function(s,t,a){s.exports=a.p+"assets/img/image-20230817112905760.4d330103.png"},881:function(s,t,a){s.exports=a.p+"assets/img/image-20230817113435842.aaa364f4.png"},882:function(s,t,a){s.exports=a.p+"assets/img/image-20230817113730881.ae156dac.png"},883:function(s,t,a){s.exports=a.p+"assets/img/image-20230817113828313.da70d7fb.png"},884:function(s,t,a){s.exports=a.p+"assets/img/image-20230817140358412.3955fd72.png"},885:function(s,t,a){s.exports=a.p+"assets/img/image-20230817140703650.779b8919.png"},886:function(s,t,a){s.exports=a.p+"assets/img/image-20230817140839240.485da25c.png"},887:function(s,t,a){s.exports=a.p+"assets/img/image-20230817141408396.4402794d.png"},888:function(s,t,a){s.exports=a.p+"assets/img/image-20230817141452855.8ee40dc1.png"},889:function(s,t,a){s.exports=a.p+"assets/img/image-20230817141940739.1943805b.png"},890:function(s,t,a){s.exports=a.p+"assets/img/image-20230817142050813.0a0bd8d9.png"},891:function(s,t,a){s.exports=a.p+"assets/img/image-20230817142340789.9425d1af.png"},892:function(s,t,a){s.exports=a.p+"assets/img/image-20230817142459193.87223505.png"},893:function(s,t,a){s.exports=a.p+"assets/img/image-20230817142639568.1f260c21.png"},894:function(s,t,a){s.exports=a.p+"assets/img/image-20230817143058475.f1c5b285.png"},895:function(s,t,a){s.exports=a.p+"assets/img/image-20230817143234136.6bc574ac.png"},896:function(s,t,a){s.exports=a.p+"assets/img/c7c952b583d6a35036ac6a2a75b1c8b8.0980b6be.png"},897:function(s,t,a){s.exports=a.p+"assets/img/b07459bc6834346365e6f715fc6f1186.36351725.png"},898:function(s,t,a){s.exports=a.p+"assets/img/adacccc107fc9b99a4fdefe0198b7b41.80854393.png"},899:function(s,t,a){s.exports=a.p+"assets/img/906fb329ebdf7beaf506de3833c93e47.a58ec0e2.png"},900:function(s,t,a){s.exports=a.p+"assets/img/f434d1b6c9447c8996a5c13ba7765633.6ace30d5.png"},901:function(s,t,a){s.exports=a.p+"assets/img/0b34f9dd4adc7e52eb07d299ba9a09e5.5c95d833.png"},902:function(s,t,a){s.exports=a.p+"assets/img/a255af9a7796c24c5958e94d0bf5b9b9.9a7dd9ab.png"},903:function(s,t,a){s.exports=a.p+"assets/img/9488e79d04c6ae7d03f127185841574a.4b332e73.png"},904:function(s,t,a){s.exports=a.p+"assets/img/6be4f110ac3d1652534cc7a6c52c31dc.209958f6.png"},905:function(s,t,a){s.exports=a.p+"assets/img/9d628e41566502d2c3c66018c38f8923.9cb31b2f.png"},906:function(s,t,a){s.exports=a.p+"assets/img/a4d01d164db1f386596761c774368084.889ff71a.png"},907:function(s,t,a){s.exports=a.p+"assets/img/9fefbba5e4fbe1130e7b9753efb89f8f.9a561f0f.png"},908:function(s,t,a){s.exports=a.p+"assets/img/3dab3991ae237415a5f0f3ae1115fa34.6a0dfa9b.png"}}]);