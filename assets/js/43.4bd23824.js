(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{1048:function(s,a,n){"use strict";n.r(a);var e=n(27),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"redis事务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis事务"}},[s._v("#")]),s._v(" Redis事务")]),s._v(" "),e("h3",{attrs:{id:"_5-1-redis事务-vs-数据库事务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-redis事务-vs-数据库事务"}},[s._v("#")]),s._v(" 5.1 Redis事务 VS 数据库事务")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("特性")]),s._v(" "),e("th",[s._v("概述")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("单独的隔离操作")]),s._v(" "),e("td",[s._v("Redis的事务仅仅是保证事务里的操作会被连续独占的执行，redis命令执行是单线程架构，在执行完事务内所有指令前是不可能再去同时执行其他客户端的请求的。")])]),s._v(" "),e("tr",[e("td",[s._v("没有隔离级别的概念")]),s._v(" "),e("td",[s._v("因为事务提交前任何指令都不会被实际执行，也就不存在“事务内的查询要看到事务里的更新，在事务外的查询不能看到”这种问题了。")])]),s._v(" "),e("tr",[e("td",[s._v("不保证原子性")]),s._v(" "),e("td",[s._v("Redis的事务不保证原子性，也就是不保证所有指令同时成功或同时失败，只有决定是否开始执行全部指令的能力，没有执行到一半进行回滚的能力。")])]),s._v(" "),e("tr",[e("td",[s._v("排它性")]),s._v(" "),e("td",[s._v("Redis会保证一个事务内的命令一次执行，而不会被其他命令插入")])])])]),s._v(" "),e("h3",{attrs:{id:"_5-2-redis事务命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-redis事务命令"}},[s._v("#")]),s._v(" 5.2 Redis事务命令")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("序号")]),s._v(" "),e("th",[s._v("命令及描述")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("1")]),s._v(" "),e("td",[e("code",[s._v("DISCARD")]),s._v("取消事务，放弃执行事务块内的所有命令。")])]),s._v(" "),e("tr",[e("td",[s._v("2")]),s._v(" "),e("td",[e("code",[s._v("EXEC")]),s._v("执行所有事务块内的命令。")])]),s._v(" "),e("tr",[e("td",[s._v("3")]),s._v(" "),e("td",[e("code",[s._v("MUTI")]),s._v("标记一个事务块的开始")])]),s._v(" "),e("tr",[e("td",[s._v("4")]),s._v(" "),e("td",[e("code",[s._v("UNWATCH")]),s._v("取消"),e("code",[s._v("WATCH")]),s._v("命令对所有"),e("code",[s._v("key")]),s._v("的监视。")])]),s._v(" "),e("tr",[e("td",[s._v("5")]),s._v(" "),e("td",[e("code",[s._v("WATCH KEY(key...)")]),s._v("监视一个或多个key，如果在事务执行之前这个key被其他命令所改动，那么事务将被打断。")])])])]),s._v(" "),e("p",[s._v("###5.3 正常执行")]),s._v(" "),e("blockquote",[e("p",[e("code",[s._v("MULTI")]),s._v("-----\x3e"),e("code",[s._v("EXEC")]),s._v("；")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('127.0.0.1:6379> multi\nOK\n127.0.0.1:6379(TX)> set k1 v1\nQUEUED\n127.0.0.1:6379(TX)> set k2 v2\nQUEUED\n127.0.0.1:6379(TX)> set k3 v3\nQUEUED\n127.0.0.1:6379(TX)> incr count\nQUEUED\n127.0.0.1:6379(TX)> exec\n1) OK\n2) OK\n3) OK\n4) (integer) 1\n127.0.0.1:6379> get k3\n"v3"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("h3",{attrs:{id:"_5-4-放弃事务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-放弃事务"}},[s._v("#")]),s._v(" 5.4 放弃事务")]),s._v(" "),e("blockquote",[e("p",[e("code",[s._v("MULTI")]),s._v("----\x3e"),e("code",[s._v("DISCARD")]),s._v("；")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('127.0.0.1:6379> multi\nOK\n127.0.0.1:6379(TX)> set k1 v11\nQUEUED\n127.0.0.1:6379(TX)> set k2 v22\nQUEUED\n127.0.0.1:6379(TX)> incr count\nQUEUED\n127.0.0.1:6379(TX)> discard\nOK\n127.0.0.1:6379> get count\n"1"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h3",{attrs:{id:"_5-5-全体连坐"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-全体连坐"}},[s._v("#")]),s._v(" 5.5 全体连坐")]),s._v(" "),e("blockquote",[e("p",[e("code",[s._v("MULTI")]),s._v("---\x3e错误指令...")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("127.0.0.1:6379> multi\nOK\n127.0.0.1:6379(TX)> set k1 v111\nQUEUED\n127.0.0.1:6379(TX)> set k2 v222\nQUEUED\n127.0.0.1:6379(TX)> incr count\nQUEUED\n127.0.0.1:6379(TX)> set k3\n(error) ERR wrong number of arguments for 'set' command\n127.0.0.1:6379(TX)> exec\n(error) EXECABORT Transaction discarded because of previous errors.\n127.0.0.1:6379> get count\n\"1\"\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("h3",{attrs:{id:"_5-6-冤头债主"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-6-冤头债主"}},[s._v("#")]),s._v(" 5.6 冤头债主")]),s._v(" "),e("blockquote",[e("p",[s._v("前期语法都没错，编译通过，执行"),e("code",[s._v("exec")]),s._v("后报错：冤有头、债有主，对的执行错的停。")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('127.0.0.1:6379> set email 123@126.com\nOK\n127.0.0.1:6379> get email\n"123@126.com"\n127.0.0.1:6379> multi\nOK\n127.0.0.1:6379(TX)> set k1 v1111\nQUEUED\n127.0.0.1:6379(TX)> set k2 v2222\nQUEUED\n127.0.0.1:6379(TX)> incr count\nQUEUED\n127.0.0.1:6379(TX)> incr email\nQUEUED\n127.0.0.1:6379(TX)> set k3 v3333\nQUEUED\n127.0.0.1:6379(TX)> exec\n1) OK\n2) OK\n3) (integer) 2\n4) (error) ERR value is not an integer or out of range\n5) OK\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])]),e("h3",{attrs:{id:"_5-7-watch监控"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-7-watch监控"}},[s._v("#")]),s._v(" 5.7 watch监控")]),s._v(" "),e("blockquote",[e("p",[e("code",[s._v("Redis")]),s._v("使用"),e("code",[s._v("Watch")]),s._v("来提供乐观锁定，类似于"),e("code",[s._v("CAS")]),s._v("。")]),s._v(" "),e("p",[e("code",[s._v("Watch")]),s._v("：初始化"),e("code",[s._v("k1")]),s._v("和"),e("code",[s._v("balance")]),s._v("两个"),e("code",[s._v("key")]),s._v("，先监控在开启"),e("code",[s._v("multi")]),s._v("，保证两个"),e("code",[s._v("key")]),s._v("变动在同一个事务内。")])]),s._v(" "),e("p",[e("img",{attrs:{src:n(594),alt:"image-20230424175202721"}})]),s._v(" "),e("h3",{attrs:{id:"_5-8-unwatch"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-8-unwatch"}},[s._v("#")]),s._v(" 5.8 UNWATCH")]),s._v(" "),e("blockquote",[e("p",[s._v("一旦执行了"),e("code",[s._v("exec")]),s._v("之前加的监控锁都会被取消。")])]),s._v(" "),e("p",[e("img",{attrs:{src:n(595),alt:"image-20230424175608340"}})]),s._v(" "),e("blockquote",[e("p",[s._v("当客户端连接丢失的时候（比如退出连接），所有的东西都会被取消监视。")])])])}),[],!1,null,null,null);a.default=t.exports},594:function(s,a,n){s.exports=n.p+"assets/img/image-20230424175202721.bd45b3fa.png"},595:function(s,a,n){s.exports=n.p+"assets/img/image-20230424175608340.50d39bf9.png"}}]);