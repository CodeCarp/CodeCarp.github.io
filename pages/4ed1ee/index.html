<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å››ã€è‡ªå®šä¹‰è®¤è¯ | ä¸‰å‘³ä¹¦å±‹</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/favicon.ico">
    <script crossorigin="anonymous" async="true" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4147143076931995"></script>
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-7Y35RMZFVD"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-7Y35RMZFVD');
  </script>
    <script async="true" src="https://cdn.wwads.cn/js/makemoney.js"></script>
    <meta name="description" content="ä¸‰å‘³ä¹¦å±‹ æ–‡æ¡£">
    <meta name="keywords" content="mybatis,mybatisplus,mybatis-plus,mybatisplusdoc,mybatis-plus-doc,orm,framework,toolkit">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.d114d151.css" as="style"><link rel="preload" href="/assets/js/app.395b465c.js" as="script"><link rel="preload" href="/assets/js/2.46ebd511.js" as="script"><link rel="preload" href="/assets/js/15.a28d648f.js" as="script"><link rel="prefetch" href="/assets/js/10.32c76cdd.js"><link rel="prefetch" href="/assets/js/100.80507368.js"><link rel="prefetch" href="/assets/js/101.91172815.js"><link rel="prefetch" href="/assets/js/102.f58aab1c.js"><link rel="prefetch" href="/assets/js/103.a8f43bfb.js"><link rel="prefetch" href="/assets/js/104.630e4ea7.js"><link rel="prefetch" href="/assets/js/105.7bf65960.js"><link rel="prefetch" href="/assets/js/106.b603bf96.js"><link rel="prefetch" href="/assets/js/107.1d36fd11.js"><link rel="prefetch" href="/assets/js/108.cf06045e.js"><link rel="prefetch" href="/assets/js/109.41b3e027.js"><link rel="prefetch" href="/assets/js/11.31e3c42f.js"><link rel="prefetch" href="/assets/js/110.6c94a82b.js"><link rel="prefetch" href="/assets/js/111.e8b9e393.js"><link rel="prefetch" href="/assets/js/112.fab4ad2a.js"><link rel="prefetch" href="/assets/js/113.de148d4c.js"><link rel="prefetch" href="/assets/js/114.cecb83e3.js"><link rel="prefetch" href="/assets/js/115.660f38e1.js"><link rel="prefetch" href="/assets/js/116.1a966c22.js"><link rel="prefetch" href="/assets/js/117.89b0b75f.js"><link rel="prefetch" href="/assets/js/118.f62e00e7.js"><link rel="prefetch" href="/assets/js/119.3149a7c2.js"><link rel="prefetch" href="/assets/js/12.255440bd.js"><link rel="prefetch" href="/assets/js/120.c7efbcd6.js"><link rel="prefetch" href="/assets/js/121.e4bfcaff.js"><link rel="prefetch" href="/assets/js/122.84dc8ede.js"><link rel="prefetch" href="/assets/js/123.72bdf527.js"><link rel="prefetch" href="/assets/js/124.d3c939c1.js"><link rel="prefetch" href="/assets/js/125.8355dc27.js"><link rel="prefetch" href="/assets/js/126.b3897b41.js"><link rel="prefetch" href="/assets/js/127.11cdc4e8.js"><link rel="prefetch" href="/assets/js/128.0e0e4507.js"><link rel="prefetch" href="/assets/js/129.b47a40be.js"><link rel="prefetch" href="/assets/js/13.bc36ab96.js"><link rel="prefetch" href="/assets/js/130.62756866.js"><link rel="prefetch" href="/assets/js/131.99bf6c7b.js"><link rel="prefetch" href="/assets/js/132.ca785ce3.js"><link rel="prefetch" href="/assets/js/133.b550091b.js"><link rel="prefetch" href="/assets/js/134.cb399c94.js"><link rel="prefetch" href="/assets/js/135.46f27054.js"><link rel="prefetch" href="/assets/js/136.8eff6473.js"><link rel="prefetch" href="/assets/js/137.26672143.js"><link rel="prefetch" href="/assets/js/138.1236bc8d.js"><link rel="prefetch" href="/assets/js/139.78cfa577.js"><link rel="prefetch" href="/assets/js/14.a96f344b.js"><link rel="prefetch" href="/assets/js/140.c5848620.js"><link rel="prefetch" href="/assets/js/141.b70af4cb.js"><link rel="prefetch" href="/assets/js/142.06233509.js"><link rel="prefetch" href="/assets/js/143.add4d037.js"><link rel="prefetch" href="/assets/js/144.c96f3242.js"><link rel="prefetch" href="/assets/js/145.68f623ef.js"><link rel="prefetch" href="/assets/js/146.49a8c3b1.js"><link rel="prefetch" href="/assets/js/147.66aeb8d7.js"><link rel="prefetch" href="/assets/js/148.426d91b6.js"><link rel="prefetch" href="/assets/js/149.e97b1f30.js"><link rel="prefetch" href="/assets/js/150.3d49a077.js"><link rel="prefetch" href="/assets/js/151.1bed6f94.js"><link rel="prefetch" href="/assets/js/152.d02b86c0.js"><link rel="prefetch" href="/assets/js/153.0fef7b7a.js"><link rel="prefetch" href="/assets/js/154.0e150e0f.js"><link rel="prefetch" href="/assets/js/155.5e6e31f0.js"><link rel="prefetch" href="/assets/js/156.31904eb7.js"><link rel="prefetch" href="/assets/js/157.e95b8508.js"><link rel="prefetch" href="/assets/js/158.fbe877f4.js"><link rel="prefetch" href="/assets/js/159.cf90c2bf.js"><link rel="prefetch" href="/assets/js/16.3a23f809.js"><link rel="prefetch" href="/assets/js/160.9cd7320a.js"><link rel="prefetch" href="/assets/js/161.700b1b74.js"><link rel="prefetch" href="/assets/js/162.dd181386.js"><link rel="prefetch" href="/assets/js/163.0d1bab8d.js"><link rel="prefetch" href="/assets/js/164.886be8a8.js"><link rel="prefetch" href="/assets/js/165.6dfb790d.js"><link rel="prefetch" href="/assets/js/166.c89861b8.js"><link rel="prefetch" href="/assets/js/167.7dc2a124.js"><link rel="prefetch" href="/assets/js/168.02f839da.js"><link rel="prefetch" href="/assets/js/169.74840c39.js"><link rel="prefetch" href="/assets/js/17.e14eec1b.js"><link rel="prefetch" href="/assets/js/170.fa4f9965.js"><link rel="prefetch" href="/assets/js/171.5c07f041.js"><link rel="prefetch" href="/assets/js/172.2304dd58.js"><link rel="prefetch" href="/assets/js/173.96eb2323.js"><link rel="prefetch" href="/assets/js/174.937b83da.js"><link rel="prefetch" href="/assets/js/175.9e485aa1.js"><link rel="prefetch" href="/assets/js/176.c923803f.js"><link rel="prefetch" href="/assets/js/177.8d1ef786.js"><link rel="prefetch" href="/assets/js/178.7afef6a6.js"><link rel="prefetch" href="/assets/js/179.9d791db4.js"><link rel="prefetch" href="/assets/js/18.84f13da6.js"><link rel="prefetch" href="/assets/js/180.ce96b166.js"><link rel="prefetch" href="/assets/js/181.1c3a31b6.js"><link rel="prefetch" href="/assets/js/19.c030ffa9.js"><link rel="prefetch" href="/assets/js/20.44025665.js"><link rel="prefetch" href="/assets/js/21.39dbe144.js"><link rel="prefetch" href="/assets/js/22.34803ea6.js"><link rel="prefetch" href="/assets/js/23.76c4856e.js"><link rel="prefetch" href="/assets/js/24.5b20599d.js"><link rel="prefetch" href="/assets/js/25.a5c528e9.js"><link rel="prefetch" href="/assets/js/26.2dfa4686.js"><link rel="prefetch" href="/assets/js/27.4d7cfc84.js"><link rel="prefetch" href="/assets/js/28.2cbd15bb.js"><link rel="prefetch" href="/assets/js/29.f2a70080.js"><link rel="prefetch" href="/assets/js/3.2fd6d236.js"><link rel="prefetch" href="/assets/js/30.df015f1a.js"><link rel="prefetch" href="/assets/js/31.d9705f6e.js"><link rel="prefetch" href="/assets/js/32.d4ba9ca1.js"><link rel="prefetch" href="/assets/js/33.c512641a.js"><link rel="prefetch" href="/assets/js/34.36826978.js"><link rel="prefetch" href="/assets/js/35.594ffe68.js"><link rel="prefetch" href="/assets/js/36.68effaf3.js"><link rel="prefetch" href="/assets/js/37.f57fe588.js"><link rel="prefetch" href="/assets/js/38.ec648ebf.js"><link rel="prefetch" href="/assets/js/39.a94f033b.js"><link rel="prefetch" href="/assets/js/4.a91050a9.js"><link rel="prefetch" href="/assets/js/40.3b66e8f2.js"><link rel="prefetch" href="/assets/js/41.7727d2ad.js"><link rel="prefetch" href="/assets/js/42.7d47f339.js"><link rel="prefetch" href="/assets/js/43.4bd23824.js"><link rel="prefetch" href="/assets/js/44.750726e7.js"><link rel="prefetch" href="/assets/js/45.f0827803.js"><link rel="prefetch" href="/assets/js/46.9cbf7e93.js"><link rel="prefetch" href="/assets/js/47.fef88f24.js"><link rel="prefetch" href="/assets/js/48.9e9188e7.js"><link rel="prefetch" href="/assets/js/49.010c1ef4.js"><link rel="prefetch" href="/assets/js/5.1898a1b5.js"><link rel="prefetch" href="/assets/js/50.6785f531.js"><link rel="prefetch" href="/assets/js/51.a5ea487a.js"><link rel="prefetch" href="/assets/js/52.9c4e53fd.js"><link rel="prefetch" href="/assets/js/53.854ad1bd.js"><link rel="prefetch" href="/assets/js/54.fb0209ed.js"><link rel="prefetch" href="/assets/js/55.1da70c42.js"><link rel="prefetch" href="/assets/js/56.17176242.js"><link rel="prefetch" href="/assets/js/57.35f5e757.js"><link rel="prefetch" href="/assets/js/58.8d692c66.js"><link rel="prefetch" href="/assets/js/59.6cd79ffb.js"><link rel="prefetch" href="/assets/js/6.0667b17e.js"><link rel="prefetch" href="/assets/js/60.99fac602.js"><link rel="prefetch" href="/assets/js/61.7a3cceb3.js"><link rel="prefetch" href="/assets/js/62.ae5f3540.js"><link rel="prefetch" href="/assets/js/63.f93b939e.js"><link rel="prefetch" href="/assets/js/64.398e6580.js"><link rel="prefetch" href="/assets/js/65.19734180.js"><link rel="prefetch" href="/assets/js/66.f61c739d.js"><link rel="prefetch" href="/assets/js/67.51d54f0a.js"><link rel="prefetch" href="/assets/js/68.1ce84095.js"><link rel="prefetch" href="/assets/js/69.684e5134.js"><link rel="prefetch" href="/assets/js/7.891222a2.js"><link rel="prefetch" href="/assets/js/70.40d6a11e.js"><link rel="prefetch" href="/assets/js/71.d037f460.js"><link rel="prefetch" href="/assets/js/72.b3c47ec2.js"><link rel="prefetch" href="/assets/js/73.68f66ce7.js"><link rel="prefetch" href="/assets/js/74.f2cd8dcf.js"><link rel="prefetch" href="/assets/js/75.6ac77895.js"><link rel="prefetch" href="/assets/js/76.d7b1562c.js"><link rel="prefetch" href="/assets/js/77.db55caca.js"><link rel="prefetch" href="/assets/js/78.df88bf6f.js"><link rel="prefetch" href="/assets/js/79.29d234f4.js"><link rel="prefetch" href="/assets/js/8.70a5e421.js"><link rel="prefetch" href="/assets/js/80.fc1069d8.js"><link rel="prefetch" href="/assets/js/81.cce589e5.js"><link rel="prefetch" href="/assets/js/82.c7ae7c93.js"><link rel="prefetch" href="/assets/js/83.19a7cfb0.js"><link rel="prefetch" href="/assets/js/84.824095a7.js"><link rel="prefetch" href="/assets/js/85.d353cc0a.js"><link rel="prefetch" href="/assets/js/86.4aba48af.js"><link rel="prefetch" href="/assets/js/87.c40b74a1.js"><link rel="prefetch" href="/assets/js/88.7cfabcdd.js"><link rel="prefetch" href="/assets/js/89.dfe0d0bf.js"><link rel="prefetch" href="/assets/js/9.dd1fe4e3.js"><link rel="prefetch" href="/assets/js/90.fafc0ea2.js"><link rel="prefetch" href="/assets/js/91.bd60e8a8.js"><link rel="prefetch" href="/assets/js/92.554fbc84.js"><link rel="prefetch" href="/assets/js/93.d562a001.js"><link rel="prefetch" href="/assets/js/94.a8416b9d.js"><link rel="prefetch" href="/assets/js/95.63cb0c71.js"><link rel="prefetch" href="/assets/js/96.09d4c442.js"><link rel="prefetch" href="/assets/js/97.c38aa36b.js"><link rel="prefetch" href="/assets/js/98.8ea65274.js"><link rel="prefetch" href="/assets/js/99.562bbdf4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d114d151.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="ä¸‰å‘³ä¹¦å±‹" class="logo"> <span class="site-name can-hide">ä¸‰å‘³ä¹¦å±‹</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/pages/a2c223/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/a2c223/" class="nav-link">JavaåŸºç¡€å…¥é—¨</a></li><li class="dropdown-item"><!----> <a href="/pages/cae45b/" class="nav-link">webå¼€å‘</a></li><li class="dropdown-item"><!----> <a href="/pages/0821f9/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/pages/57e0a9/" class="nav-link">SpringMVC</a></li><li class="dropdown-item"><!----> <a href="/pages/d9ebe1/" class="nav-link">MyBatis</a></li><li class="dropdown-item"><!----> <a href="/pages/c1c654/" class="nav-link">SSMæ•´åˆ</a></li><li class="dropdown-item"><!----> <a href="/pages/3c8c4d/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/pages/240195/" class="nav-link">SpringSecurity</a></li><li class="dropdown-item"><!----> <a href="/pages/202d71/" class="nav-link">ActiveMQ</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯" class="dropdown-title"><a href="/pages/4b7f26/" class="link-title">å‰ç«¯</a> <span class="title" style="display:none;">å‰ç«¯</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/4b7f26/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/pages/85ab5d/" class="nav-link">VUE</a></li><li class="dropdown-item"><!----> <a href="/pages/35ad38/" class="nav-link">AJAX</a></li></ul></div></div><div class="nav-item"><a href="/pages/8e08b7/" class="nav-link">Linux</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ•°æ®åº“" class="dropdown-title"><a href="/pages/6d7041/" class="link-title">æ•°æ®åº“</a> <span class="title" style="display:none;">æ•°æ®åº“</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/6d7041/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ§°å·¥å…·" class="dropdown-title"><a href="/pages/9f2650/" class="link-title">ğŸ§°å·¥å…·</a> <span class="title" style="display:none;">ğŸ§°å·¥å…·</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9f2650/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/ffb338/" class="nav-link">Maven</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸš€æ‰“å·¥äººç¬”è®°æœ¬" class="dropdown-title"><a href="/pages/de45d0/" class="link-title">ğŸš€æ‰“å·¥äººç¬”è®°æœ¬</a> <span class="title" style="display:none;">ğŸš€æ‰“å·¥äººç¬”è®°æœ¬</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/de45d0/" class="nav-link">Utils</a></li><li class="dropdown-item"><!----> <a href="/pages/afc7bc/" class="nav-link">æ€»ç»“</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/pages/a2c223/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/a2c223/" class="nav-link">JavaåŸºç¡€å…¥é—¨</a></li><li class="dropdown-item"><!----> <a href="/pages/cae45b/" class="nav-link">webå¼€å‘</a></li><li class="dropdown-item"><!----> <a href="/pages/0821f9/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/pages/57e0a9/" class="nav-link">SpringMVC</a></li><li class="dropdown-item"><!----> <a href="/pages/d9ebe1/" class="nav-link">MyBatis</a></li><li class="dropdown-item"><!----> <a href="/pages/c1c654/" class="nav-link">SSMæ•´åˆ</a></li><li class="dropdown-item"><!----> <a href="/pages/3c8c4d/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/pages/240195/" class="nav-link">SpringSecurity</a></li><li class="dropdown-item"><!----> <a href="/pages/202d71/" class="nav-link">ActiveMQ</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯" class="dropdown-title"><a href="/pages/4b7f26/" class="link-title">å‰ç«¯</a> <span class="title" style="display:none;">å‰ç«¯</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/4b7f26/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/pages/85ab5d/" class="nav-link">VUE</a></li><li class="dropdown-item"><!----> <a href="/pages/35ad38/" class="nav-link">AJAX</a></li></ul></div></div><div class="nav-item"><a href="/pages/8e08b7/" class="nav-link">Linux</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ•°æ®åº“" class="dropdown-title"><a href="/pages/6d7041/" class="link-title">æ•°æ®åº“</a> <span class="title" style="display:none;">æ•°æ®åº“</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/6d7041/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ§°å·¥å…·" class="dropdown-title"><a href="/pages/9f2650/" class="link-title">ğŸ§°å·¥å…·</a> <span class="title" style="display:none;">ğŸ§°å·¥å…·</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9f2650/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/ffb338/" class="nav-link">Maven</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸš€æ‰“å·¥äººç¬”è®°æœ¬" class="dropdown-title"><a href="/pages/de45d0/" class="link-title">ğŸš€æ‰“å·¥äººç¬”è®°æœ¬</a> <span class="title" style="display:none;">ğŸš€æ‰“å·¥äººç¬”è®°æœ¬</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/de45d0/" class="nav-link">Utils</a></li><li class="dropdown-item"><!----> <a href="/pages/afc7bc/" class="nav-link">æ€»ç»“</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaåŸºç¡€</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaWeb</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringMVC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MyBatis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SSMæ•´åˆ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SpringSecurity</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/240195/" class="sidebar-link">ä¸€ã€æƒé™ç®¡ç†</a></li><li><a href="/pages/1482d8/" class="sidebar-link">äºŒã€æ•´ä½“æ¶æ„</a></li><li><a href="/pages/eedb43/" class="sidebar-link">ä¸‰ã€ç¯å¢ƒæ­å»º</a></li><li><a href="/pages/4ed1ee/" aria-current="page" class="active sidebar-link">å››ã€è‡ªå®šä¹‰è®¤è¯</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/4ed1ee/#å››ã€è‡ªå®šä¹‰è®¤è¯" class="sidebar-link">å››ã€è‡ªå®šä¹‰è®¤è¯</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/4ed1ee/#_4-1-è‡ªå®šä¹‰ç™»å½•ç•Œé¢" class="sidebar-link">4.1 è‡ªå®šä¹‰ç™»å½•ç•Œé¢</a></li><li class="sidebar-sub-header level3"><a href="/pages/4ed1ee/#_4-2-è‡ªå®šä¹‰ç™»å½•æˆåŠŸå¤„ç†" class="sidebar-link">4.2 è‡ªå®šä¹‰ç™»å½•æˆåŠŸå¤„ç†</a></li><li class="sidebar-sub-header level3"><a href="/pages/4ed1ee/#_4-3-æ˜¾ç¤ºå¤±è´¥ä¿¡æ¯" class="sidebar-link">4.3 æ˜¾ç¤ºå¤±è´¥ä¿¡æ¯</a></li><li class="sidebar-sub-header level3"><a href="/pages/4ed1ee/#_4-4-è‡ªå®šä¹‰ç™»å½•å¤±è´¥å¤„ç†" class="sidebar-link">4.4 è‡ªå®šä¹‰ç™»å½•å¤±è´¥å¤„ç†</a></li><li class="sidebar-sub-header level3"><a href="/pages/4ed1ee/#_4-5-æ³¨é”€ç™»å½•" class="sidebar-link">4.5 æ³¨é”€ç™»å½•</a></li><li class="sidebar-sub-header level3"><a href="/pages/4ed1ee/#_4-6-ç™»å½•ç”¨æˆ·æ•°æ®è·å–" class="sidebar-link">4.6 ç™»å½•ç”¨æˆ·æ•°æ®è·å–</a></li><li class="sidebar-sub-header level3"><a href="/pages/4ed1ee/#_4-7-è‡ªå®šä¹‰è®¤è¯æ•°æ®æº" class="sidebar-link">4.7 è‡ªå®šä¹‰è®¤è¯æ•°æ®æº</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ActiveMQ</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>Java</span></li><li data-v-06225672><span data-v-06225672>SpringSecurity</span></li></ul> <div class="info" data-v-06225672><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-06225672><a href="javascript:;" data-v-06225672>yli</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-08-22</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">å››ã€è‡ªå®šä¹‰è®¤è¯<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="å››ã€è‡ªå®šä¹‰è®¤è¯"><a href="#å››ã€è‡ªå®šä¹‰è®¤è¯" class="header-anchor">#</a> å››ã€è‡ªå®šä¹‰è®¤è¯</h2> <p><img src="/assets/img/image-20230718142525331.78e86a36.png" alt="image-20230718142525331"></p> <blockquote><ul><li>/index å…¬å…±èµ„æº</li> <li>/hello å—ä¿æŠ¤èµ„æº æƒé™ç®¡ç†</li></ul> <p>åœ¨é¡¹ç›®ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®å°±å¯ä»¥å®ç°å¯¹èµ„æºæƒé™è§„åˆ™è®¾å®šï¼š</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfigurer</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>
     <span class="token annotation punctuation">@Override</span>
     <span class="token comment">/**
      *    permitAll() ä»£è¡¨æ”¾è¡Œè¯¥èµ„æº,è¯¥èµ„æºä¸ºå…¬å…±èµ„æºï¼Œæ— éœ€è®¤è¯å’Œæˆæƒå¯ä»¥ç›´æ¥è®¿é—®
      *    anyRequest().authenticated() ä»£è¡¨æ‰€æœ‰è¯·æ±‚,å¿…é¡»è®¤è¯ä¹‹åæ‰èƒ½è®¿é—®
      *    formLogin() ä»£è¡¨å¼€å¯è¡¨å•è®¤è¯
      * æ³¨æ„: æ”¾è¡Œèµ„æºå¿…é¡»æ”¾åœ¨æ‰€æœ‰è®¤è¯è¯·æ±‚ä¹‹å‰!
      */</span>
     <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
         http<span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">mvcMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//æ”¾è¡Œèµ„æºå†™åœ¨ä»»ä½•å‰é¢</span>
                 <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><blockquote><p><strong>æ³¨æ„</strong>ï¼šåœ¨springBoot 2.7.1 ä¸­çš„Spring-security-config-5.7.2.RELEASEä¸­ä»¥æåˆ°WebSecurityConfigurerAdapterå·²è¿‡æ—¶è¢«å¼ƒç”¨ï¼Œæ›¿ä»£æ–¹æ³•å¦‚ä¸‹ï¼š</p> <ol><li>ä½¿ç”¨SecurityFilterChain Beanæ¥é…ç½®HttpSecurity</li> <li>ä½¿ç”¨WebSecurityCustomizer Beanæ¥é…ç½®WebSecurityã€‚</li></ol> <p><strong>æ›¿ä»£åæ–°ä»£ç ä¸ºï¼š</strong></p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token annotation punctuation">@Configuration</span>
 <span class="token annotation punctuation">@EnableWebSecurity</span> <span class="token comment">//æ·»åŠ securityè¿‡æ»¤å™¨ï¼Œæ­¤å¤„ä¸€å®šè¦åŠ å…¥æ­¤æ³¨è§£ï¼Œå¦åˆ™ä¸‹é¢çš„httpSecurityæ— æ³•è£…é…</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfig</span> <span class="token punctuation">{</span>
     <span class="token comment">/**
      *    permitAll() ä»£è¡¨æ”¾è¡Œè¯¥èµ„æº,è¯¥èµ„æºä¸ºå…¬å…±èµ„æºï¼Œæ— éœ€è®¤è¯å’Œæˆæƒå¯ä»¥ç›´æ¥è®¿é—®
      *    anyRequest().authenticated() ä»£è¡¨æ‰€æœ‰è¯·æ±‚,å¿…é¡»è®¤è¯ä¹‹åæ‰èƒ½è®¿é—®
      *    formLogin() ä»£è¡¨å¼€å¯è¡¨å•è®¤è¯
      * æ³¨æ„: æ”¾è¡Œèµ„æºå¿…é¡»æ”¾åœ¨æ‰€æœ‰è®¤è¯è¯·æ±‚ä¹‹å‰!
      */</span>
     <span class="token annotation punctuation">@Bean</span>
     <span class="token class-name">SecurityFilterChain</span> <span class="token function">filterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> httpSecurity
                 <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">mvcMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><blockquote><p>æ€»ç»“ï¼šæ–°æ›¿ä»£æ–¹æ¡ˆä¸­çš„SpringSecurityå°±ä¸éœ€è¦å†å»ç»§æ‰¿WebSecurityConfigAdapterï¼Œç„¶åé‡å†™configure()æ–¹æ³•äº†ï¼Œç›´æ¥é€šè¿‡filterChain()æ–¹æ³•å°±èƒ½ä½¿ç”¨HttpSecurityæ¥é…ç½®ç›¸å…³ä¿¡æ¯ã€‚</p></blockquote> <h3 id="_4-1-è‡ªå®šä¹‰ç™»å½•ç•Œé¢"><a href="#_4-1-è‡ªå®šä¹‰ç™»å½•ç•Œé¢" class="header-anchor">#</a> 4.1 è‡ªå®šä¹‰ç™»å½•ç•Œé¢</h3> <blockquote><p>pom.xmlå¼•å…¥Thymeleafæ¨¡æ¿ä¾èµ–</p></blockquote> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--å¼•å…¥Thymeleafä¾èµ–--&gt;</span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>application.propertiesé…ç½®Thymeleaf</p></blockquote> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># Thymeleafé…ç½®</span>
<span class="token comment"># å…³é—­ç¼“å­˜</span>
<span class="token attr-name">spring.thymeleaf.cache</span><span class="token punctuation">=</span><span class="token attr-value">false </span>
<span class="token comment"># é»˜è®¤å‰ç¼€è·¯å¾„ï¼Œå¯ä¸é…ç½®</span>
<span class="token attr-name">spring.thymeleaf.prefix</span><span class="token punctuation">=</span><span class="token attr-value">classpath:/templates/</span>
<span class="token comment"># é»˜è®¤æ–‡ä»¶åç¼€ï¼Œå¯ä¸é…ç½®</span>
<span class="token attr-name">spring.thymeleaf.suffix</span><span class="token punctuation">=</span><span class="token attr-value">.html </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>å®šä¹‰ç™»å½•é¡µé¢Loginontroller</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginController</span> <span class="token punctuation">{</span>
     <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/login.html&quot;</span><span class="token punctuation">)</span> <span class="token comment">//æ³¨æ„æ­¤å¤„æ˜¯login.htmlè€Œä¸æ˜¯login</span>
     <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token string">&quot;login&quot;</span><span class="token punctuation">;</span><span class="token comment">//å°è£…ä¸ºlogin.html</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p><strong>åœ¨ templates ä¸­å®šä¹‰ç™»å½•ç•Œé¢login.html</strong></p></blockquote> <div class="language-html line-numbers-mode"><pre class="language-html"><code> <span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://www.thymeleaf.org<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>ç™»å½•é¡µé¢<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>ç”¨æˆ·ç™»å½•<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/doLogin}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
     ç”¨æˆ·åï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uname<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--æ­¤å¤„çš„nameå±æ€§å¯æŒ‡å®šå…¶å®ƒåç§°ï¼Œä½†éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®--&gt;</span>
     å¯†ç ï¼š <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pwd<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--æ­¤å¤„çš„nameå±æ€§å¯æŒ‡å®šå…¶å®ƒåç§°ï¼Œä½†éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®--&gt;</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ç™»å½•<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><blockquote><p><font style="color:red;font-weight:600;">æ³¨æ„ï¼šÂ Â </font></p> <ul><li>ç™»å½•è¡¨å•<code>method</code>å¿…é¡»ä¸º<code>post</code>,<code>action</code>çš„è¯·æ±‚è·¯å¾„å¯ä»¥å®šä¹‰ä¸º<code>/doLogin</code></li> <li>ç”¨æˆ·åçš„<code>name</code>å±æ€§ä¸º<code>username</code>ï¼Œç”¨æˆ·åå¯ä»¥æŒ‡å®šä¸ºé™¤<code>username</code>å¤–çš„å…¶ä»–åç§°</li> <li>å¯†ç çš„<code>name</code>å±æ€§ä¸º<code>password</code>ï¼Œå¯†ç å¯ä»¥æŒ‡å®šä¸ºé™¤<code>password</code>å¤–çš„å…¶ä»–åç§°</li></ul></blockquote> <blockquote><p><strong>é…ç½® Spring Security é…ç½®ç±»WebSecurityConfigurer</strong></p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfigurer</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>
     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
         http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">mvcMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//æ”¾è¡Œ/indexè¯·æ±‚</span>
                 <span class="token punctuation">.</span><span class="token function">mvcMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/login.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//æ”¾è¡Œ/login.htmlè¯·æ±‚</span>
                 <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//å…¶å®ƒè¯·æ±‚éœ€è¦ç™»å½•è®¤è¯åæ‰èƒ½è®¿é—®</span>
                 <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//é»˜è®¤formè¡¨å•é¡µé¢ç™»å½•</span>
                 <span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login.html&quot;</span><span class="token punctuation">)</span> <span class="token comment">//ä½¿ç”¨è‡ªå®šä¹‰ç™»å½•é¡µé¢ç™»å½•é¡µé¢ç™»å½•</span>
                 <span class="token punctuation">.</span><span class="token function">loginProcessingUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/doLogin&quot;</span><span class="token punctuation">)</span> <span class="token comment">//ä½¿ç”¨è‡ªå®šä¹‰ç™»å½•é¡µé¢æ—¶éœ€è¦é‡æ–°æŒ‡å®šurlï¼Œå¯¹åº”login.htmlä¸­çš„actionè·¯å¾„</span>
                 <span class="token punctuation">.</span><span class="token function">usernameParameter</span><span class="token punctuation">(</span><span class="token string">&quot;uname&quot;</span><span class="token punctuation">)</span> <span class="token comment">//é‡æ–°æŒ‡å®šç”¨æˆ·ååç§°</span>
                 <span class="token punctuation">.</span><span class="token function">passwordParameter</span><span class="token punctuation">(</span><span class="token string">&quot;pwd&quot;</span><span class="token punctuation">)</span> <span class="token comment">//é‡æ–°æŒ‡å®šå¯†ç åç§°</span>
                 <span class="token punctuation">.</span><span class="token function">successForwardUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/index&quot;</span><span class="token punctuation">)</span> <span class="token comment">//è®¤è¯æˆåŠŸåè·³è½¬è·¯å¾„</span>
                 <span class="token comment">//forward è·³è½¬è·¯å¾„  å§‹ç»ˆåœ¨è®¤è¯æˆåŠŸä¹‹åè·³è½¬åˆ°æŒ‡å®šè¯·æ±‚ åœ°å€æ ä¸å˜</span>
                 <span class="token comment">//.defaultSuccessUrl(&quot;/hello&quot;) //é»˜è®¤è®¤è¯æˆåŠŸåè·³è½¬è·¯å¾„</span>
                 <span class="token comment">//.defaultSuccessUrl(&quot;/hello&quot;,true) //ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ä¸ºtrueæ—¶æ€»æ˜¯è·³è½¬ï¼Œæ•ˆæœåŒsuccessForwardUrlä¸€è‡´ï¼Œé»˜è®¤false</span>
                 <span class="token comment">//redirect é‡å®šå‘  æ³¨æ„:å¦‚æœä¹‹å‰æœ‰è¯·æ±‚è¿‡çš„è·¯å¾„,ä¼šä¼˜å…ˆè·³è½¬ä¹‹å‰çš„è¯·æ±‚è·¯å¾„ åœ°å€æ æ”¹å˜</span>
                 <span class="token punctuation">.</span><span class="token function">failureUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login.html&quot;</span><span class="token punctuation">)</span> <span class="token comment">//ç™»å½•å¤±è´¥åè·³è½¬è·¯å¾„</span>
                 <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ­¤å¤„å…ˆå…³é—­CSRFè·¨ç«™ä¿æŠ¤</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><blockquote><p><font style="color:red;font-weight:600;">æ³¨æ„ï¼šÂ Â </font></p> <ul><li><code>successForwardUrl</code>ã€<code>defaultSuccessUrl</code>è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥å®ç°æˆåŠŸä¹‹åè·³è½¬ï¼Œå…¶ä¸­ï¼š
<ul><li><code>successForwardUrl</code>é»˜è®¤ä½¿ç”¨<code>forword</code>è·³è½¬ï¼Œä¸ä¼šè·³è½¬åˆ°ä¹‹å‰è·¯å¾„</li> <li><code>defaultSuccessUrl</code>é»˜è®¤ä½¿ç”¨<code>redirect</code>è·³è½¬ï¼Œå¦‚æœä¹‹å‰è¯·æ±‚è·¯å¾„ï¼Œä¼šæœ‰ä¼˜å…ˆè·³è½¬ä¹‹å‰è¯·æ±‚è·¯å¾„ï¼Œå¯ä»¥ä¼ å…¥å‚æ•°è¿›è¡Œä¿®æ”¹</li></ul></li></ul></blockquote> <h3 id="_4-2-è‡ªå®šä¹‰ç™»å½•æˆåŠŸå¤„ç†"><a href="#_4-2-è‡ªå®šä¹‰ç™»å½•æˆåŠŸå¤„ç†" class="header-anchor">#</a> 4.2 è‡ªå®šä¹‰ç™»å½•æˆåŠŸå¤„ç†</h3> <blockquote><p>æœ‰æ—¶å€™é¡µé¢è·³è½¬å¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬ï¼Œç‰¹åˆ«æ˜¯åœ¨å‰åç«¯åˆ†ç¦»å¼€å‘ä¸­å°±ä¸éœ€è¦æˆåŠŸä¹‹åè·³è½¬é¡µé¢ï¼Œåªéœ€è¦ç»™å‰ç«¯è¿”å›ä¸€ä¸ª<code>JSON</code>æ•°æ®é€šçŸ¥ç™»å½•æˆåŠŸè¿˜æ˜¯å¤±è´¥ä¸å¦ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ <code>AuthenticationSucccessHandler</code> å®ç°ã€‚</p></blockquote> <div class="language-JAVA line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AuthenticationSuccessHandler</span> <span class="token punctuation">{</span>
     <span class="token comment">/**
      * Called when a user has been successfully authenticated.
      * @param request the request which caused the successful authentication
      * @param response the response
      * @param authentication the &lt;tt&gt;Authentication&lt;/tt&gt; object which was created during
      * the authentication process.
      */</span>
     <span class="token keyword">void</span> <span class="token function">onAuthenticationSuccess</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span>
             <span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p><strong>æ ¹æ®æ¥å£çš„æè¿°ä¿¡æ¯ä¹Ÿå¯ä»¥å¾—çŸ¥ï¼Œç™»å½•æˆåŠŸåä¼šè‡ªåŠ¨å›è°ƒè¿™ä¸ªæ–¹æ³•ï¼Œè¿›ä¸€æ­¥æŸ¥çœ‹å®ƒçš„é»˜è®¤å®ç°ï¼Œä½ ä¼šå‘ç°<code>successForwardUrl</code>ã€<code>defaultSuccessUrl</code>ä¹Ÿæ˜¯ç”±å®ƒçš„å­ç±»å®ç°çš„ï¼š</strong></p></blockquote> <p><img src="/assets/img/image-20230815101421600.bf09f246.png" alt="image-20230815101421600"></p> <p><strong>åœ¨configåŒ…ä¸­è‡ªå®šä¹‰ <code>AuthenticationSuccessHandler</code>æ¥å£å®ç°ç±»<code>MyAuthenticationSuccessHandler</code></strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAuthenticationSuccessHandler</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationSuccessHandler</span> <span class="token punctuation">{</span>
     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAuthenticationSuccess</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
         <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ç™»å½•æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰“å°ç™»å½•æˆåŠŸä¿¡æ¯</span>
         result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰“å°çŠ¶æ€ç </span>
         result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;authentication&quot;</span><span class="token punctuation">,</span> authentication<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰“å°è®¤è¯ä¿¡æ¯</span>
         response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è®¾ç½®å“åº”ç±»å‹</span>
         <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//jsonæ ¼å¼è½¬å­—ç¬¦ä¸²</span>
         response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰“å°jsonæ ¼å¼æ•°æ®</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>åœ¨<code>WebSecurityConfigurer</code>ä¸­é…ç½®<code>MyAuthenticationSuccessHandler</code></strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token annotation punctuation">@Configuration</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfigurer</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>
     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                 <span class="token comment">//.successForwardUrl(&quot;/index&quot;) //è®¤è¯æˆåŠŸåè·³è½¬è·¯å¾„ forward è·³è½¬è·¯å¾„  å§‹ç»ˆåœ¨è®¤è¯æˆåŠŸä¹‹åè·³è½¬åˆ°æŒ‡å®šè¯·æ±‚ åœ°å€æ ä¸å˜</span>
                 <span class="token comment">//.defaultSuccessUrl(&quot;/hello&quot;) //é»˜è®¤è®¤è¯æˆåŠŸåè·³è½¬è·¯å¾„ redirect é‡å®šå‘  æ³¨æ„:å¦‚æœä¹‹å‰æœ‰è¯·æ±‚è¿‡çš„è·¯å¾„,ä¼šä¼˜å…ˆè·³è½¬ä¹‹å‰çš„è¯·æ±‚è·¯å¾„ åœ°å€æ æ”¹å˜</span>
                 <span class="token comment">//.defaultSuccessUrl(&quot;/hello&quot;,true) //ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ä¸ºtrueæ—¶æ€»æ˜¯è·³è½¬ï¼Œæ•ˆæœåŒsuccessForwardUrlä¸€è‡´ï¼Œé»˜è®¤false</span>
                 <span class="token punctuation">.</span><span class="token function">successHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//è®¤è¯æˆåŠŸæ—¶å¤„ç†ï¼Œå‰åç«¯åˆ†ç¦»è§£å†³æ–¹æ¡ˆ</span>
                 <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ­¤å¤„å…ˆå…³é—­CSRFè·¨ç«™ä¿æŠ¤</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>è®¿é—®è·¯å¾„ï¼šhttp://localhost:8080/helloï¼Œè¾“å…¥ç”¨æˆ·åå¯†ç ç™»å½•åï¼Œè¾“å‡ºç»“æœï¼š</strong></p> <p><img src="/assets/img/image-20230815101922651.649f2de7.png" alt="image-20230815101922651"></p> <h3 id="_4-3-æ˜¾ç¤ºå¤±è´¥ä¿¡æ¯"><a href="#_4-3-æ˜¾ç¤ºå¤±è´¥ä¿¡æ¯" class="header-anchor">#</a> 4.3 æ˜¾ç¤ºå¤±è´¥ä¿¡æ¯</h3> <blockquote><p>ä¸ºäº†èƒ½æ›´ç›´è§‚åœ°åœ¨ç™»å½•é¡µé¢çœ‹åˆ°å¼‚å¸¸é”™è¯¯ä¿¡æ¯ï¼Œå¯ä»¥åœ¨ç™»å½•é¡µé¢ä¸­ç›´æ¥è·å–å¼‚å¸¸ä¿¡æ¯ã€‚<code>Spring Security</code>åœ¨ç™»å½•å¤±è´¥ä¹‹åä¼šå°†å¼‚å¸¸ä¿¡æ¯å­˜å‚¨åˆ°<code>request</code>ã€<code>session</code>ä½œç”¨åŸŸä¸­<code>key</code>ä¸º <code>SPRING_SECURITY_LAST_EXCEPTION</code>å‘½åå±æ€§ä¸­ã€‚</p> <p>æºç å¯ä»¥å‚è€ƒ <code>SimpleUrlAuthenticationFailureHandler</code>ï¼š</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleUrlAuthenticationFailureHandler</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationFailureHandler</span> <span class="token punctuation">{</span>
     <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">Log</span> logger <span class="token operator">=</span> <span class="token class-name">LogFactory</span><span class="token punctuation">.</span><span class="token function">getLog</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">private</span> <span class="token class-name">String</span> defaultFailureUrl<span class="token punctuation">;</span>
     <span class="token keyword">private</span> <span class="token keyword">boolean</span> forwardToDestination <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
     <span class="token keyword">private</span> <span class="token keyword">boolean</span> allowSessionCreation <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
     <span class="token keyword">private</span> <span class="token class-name">RedirectStrategy</span> redirectStrategy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultRedirectStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
     <span class="token keyword">public</span> <span class="token class-name">SimpleUrlAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token punctuation">}</span>
 
     <span class="token keyword">public</span> <span class="token class-name">SimpleUrlAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token class-name">String</span> defaultFailureUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setDefaultFailureUrl</span><span class="token punctuation">(</span>defaultFailureUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 
     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAuthenticationFailure</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">AuthenticationException</span> exception<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>defaultFailureUrl <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                 <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Sending 401 Unauthorized error since no failure URL is set&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                 <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Sending 401 Unauthorized error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
 
             response<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>UNAUTHORIZED<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>UNAUTHORIZED<span class="token punctuation">.</span><span class="token function">getReasonPhrase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
             <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveException</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>forwardToDestination<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                 <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Forwarding to &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>defaultFailureUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>defaultFailureUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                 <span class="token keyword">this</span><span class="token punctuation">.</span>redirectStrategy<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>defaultFailureUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
 
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
 
     <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">saveException</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">AuthenticationException</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>forwardToDestination<span class="token punctuation">)</span> <span class="token punctuation">{</span>
             request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;SPRING_SECURITY_LAST_EXCEPTION&quot;</span><span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
             <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>session <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>allowSessionCreation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                 request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;SPRING_SECURITY_LAST_EXCEPTION&quot;</span><span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
 
         <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 
     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDefaultFailureUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> defaultFailureUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">isTrue</span><span class="token punctuation">(</span><span class="token class-name">UrlUtils</span><span class="token punctuation">.</span><span class="token function">isValidRedirectUrl</span><span class="token punctuation">(</span>defaultFailureUrl<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
             <span class="token keyword">return</span> <span class="token string">&quot;'&quot;</span> <span class="token operator">+</span> defaultFailureUrl <span class="token operator">+</span> <span class="token string">&quot;' is not a valid redirect URL&quot;</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>defaultFailureUrl <span class="token operator">=</span> defaultFailureUrl<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 
     <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">isUseForward</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>forwardToDestination<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 
     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUseForward</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> forwardToDestination<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>forwardToDestination <span class="token operator">=</span> forwardToDestination<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 
     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRedirectStrategy</span><span class="token punctuation">(</span><span class="token class-name">RedirectStrategy</span> redirectStrategy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>redirectStrategy <span class="token operator">=</span> redirectStrategy<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 
     <span class="token keyword">protected</span> <span class="token class-name">RedirectStrategy</span> <span class="token function">getRedirectStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>redirectStrategy<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 
     <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">isAllowSessionCreation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>allowSessionCreation<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 
     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAllowSessionCreation</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> allowSessionCreation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>allowSessionCreation <span class="token operator">=</span> allowSessionCreation<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><p><img src="/assets/img/image-20230815102224876.573f15b9.png" alt="image-20230815102224876"></p> <p><strong>login.htmlä¸­æ·»åŠ æ˜¾ç¤ºå¼‚å¸¸ä¿¡æ¯ä»£ç </strong></p> <div class="language-HTML line-numbers-mode"><pre class="language-html"><code> <span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://www.thymeleaf.org<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>ç™»å½•é¡µé¢<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>ç”¨æˆ·ç™»å½•<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
 ...
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>
     <span class="token comment">&lt;!--    &lt;div th:text=&quot;${SPRING_SECURITY_LAST_EXCEPTION}&quot;&gt;&lt;/div&gt;--&gt;</span><span class="token comment">&lt;!--requestä½œç”¨åŸŸï¼šforwardè·³è½¬--&gt;</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${session.SPRING_SECURITY_LAST_EXCEPTION}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--sessionä½œç”¨åŸŸï¼šredirectè·³è½¬--&gt;</span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong><code>WebSecurityConfigurer</code>é…ç½®ç™»å½•å¤±è´¥å¤„ç†</strong></p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code> <span class="token annotation punctuation">@Configuration</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfigurer</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>
     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
         http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                 <span class="token punctuation">.</span><span class="token function">successHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//è®¤è¯æˆåŠŸæ—¶å¤„ç†ï¼Œå‰åç«¯åˆ†ç¦»è§£å†³æ–¹æ¡ˆ</span>
                 <span class="token comment">//.failureForwardUrl(&quot;/login.html&quot;)//è®¤è¯å¤±è´¥ä¹‹åï¼Œforwardè·³è½¬</span>
                 <span class="token punctuation">.</span><span class="token function">failureUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login.html&quot;</span><span class="token punctuation">)</span> <span class="token comment">//é»˜è®¤è®¤è¯å¤±è´¥ä¹‹åï¼Œredirectè·³è½¬</span>
                 <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ­¤å¤„å…ˆå…³é—­CSRFè·¨ç«™ä¿æŠ¤</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><blockquote><p><font style="color:red;font-weight:600;">æ³¨æ„ï¼šfailureUrlã€failureForwardUrl å…³ç³»ç±»ä¼¼äºä¹‹å‰æåˆ°çš„ successForwardUrl ã€defaultSuccessUrl æ–¹æ³•</font></p> <ul><li><code>ailureUrl</code>ï¼šå¤±è´¥ä»¥åçš„é‡å®šå‘è·³è½¬</li> <li><code>failureForwardUrl</code>ï¼šå¤±è´¥ä»¥åçš„ forward è·³è½¬</li></ul> <p>æ³¨æ„:å› æ­¤è·å– <code>request</code>ä¸­å¼‚å¸¸ä¿¡æ¯,è¿™é‡Œåªèƒ½ä½¿ç”¨<code>failureForwardUrl</code></p></blockquote> <p><strong>å¯åŠ¨é¡¹ç›®ï¼Œæµ‹è¯•è·¯å¾„ï¼šhttp://localhost:8080/helloï¼Œè¾“å…¥é”™è¯¯çš„ç”¨æˆ·åå’Œå¯†ç æ—¶ä¼šè¾“å‡ºå¦‚ä¸‹é”™è¯¯ä¿¡æ¯ï¼Œæ³¨æ„<code>login.html</code>ä¸<code>WebSecurityConfigurer</code>å¯¹<code>failureForwardUrl</code>æˆ–<code>failureUrl</code>çš„é…ç½®ä¸€è‡´ï¼š</strong></p> <ol><li><strong><code>failureForwardUrl</code></strong>ï¼šforwardè·³è½¬ï¼Œrequestä½œç”¨åŸŸ</li></ol> <p><img src="/assets/img/image-20230815102743805.d861daa0.png" alt="image-20230815102743805"></p> <ol start="2"><li><strong><code>failureUrl</code>ï¼šredirectè·³è½¬ï¼Œsessionä½œç”¨åŸŸ</strong></li></ol> <p><img src="/assets/img/image-20230815102822835.1f34d506.png" alt="image-20230815102822835"></p> <h3 id="_4-4-è‡ªå®šä¹‰ç™»å½•å¤±è´¥å¤„ç†"><a href="#_4-4-è‡ªå®šä¹‰ç™»å½•å¤±è´¥å¤„ç†" class="header-anchor">#</a> 4.4 è‡ªå®šä¹‰ç™»å½•å¤±è´¥å¤„ç†</h3> <blockquote><p>å’Œè‡ªå®šä¹‰ç™»å½•æˆåŠŸå¤„ç†ä¸€æ ·ï¼ŒSpring Security åŒæ ·ä¸ºå‰åç«¯åˆ†ç¦»å¼€å‘æä¾›äº†ç™»å½•å¤±è´¥çš„å¤„ç†ï¼Œè¿™ä¸ªç±»å°±æ˜¯ <code>AuthenticationFailureHandler</code>ï¼Œæºç ä¸ºï¼š</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AuthenticationFailureHandler</span> <span class="token punctuation">{</span>
     <span class="token comment">/**
      * Called when an authentication attempt fails.
      * @param request the request during which the authentication attempt occurred.
      * @param response the response.
      * @param exception the exception which was thrown to reject the authentication
      * request.
      */</span>
     <span class="token keyword">void</span> <span class="token function">onAuthenticationFailure</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span>
             <span class="token class-name">AuthenticationException</span> exception<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span><span class="token punctuation">;</span>
 
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>æ ¹æ®æ¥å£çš„æè¿°ä¿¡æ¯,ä¹Ÿå¯ä»¥å¾—çŸ¥ç™»å½•å¤±è´¥ä¼šè‡ªåŠ¨å›è°ƒè¿™ä¸ªæ–¹æ³•ï¼Œè¿›ä¸€æ­¥æŸ¥çœ‹å®ƒçš„é»˜è®¤å®ç°ï¼Œ<code>failureUrl</code>ã€<code>failureForwardUrl</code>ä¹Ÿæ˜¯ç”±å®ƒçš„å­ç±»å®ç°çš„ã€‚</strong></p> <p><img src="/assets/img/image-20230815103147116.075fe22c.png" alt="image-20230815103147116"></p> <p><strong>configåŒ…ä¸­è‡ªå®šä¹‰ <code>AuthenticationFailureHandler</code>æ¥å£å®ç°ç±»<code>MyAuthenticationFailureHandler</code></strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAuthenticationFailureHandler</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationFailureHandler</span> <span class="token punctuation">{</span>
     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAuthenticationFailure</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">AuthenticationException</span> exception<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
         <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ç™»å½•å¤±è´¥ï¼š&quot;</span> <span class="token operator">+</span> exception<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
         response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong><code>WebSecurityConfigurer</code>é…ç½®<code>MyAuthenticationFailureHandler</code></strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfigurer</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>
     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
         http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                 <span class="token comment">//.failureForwardUrl(&quot;/login.html&quot;)//è®¤è¯å¤±è´¥ä¹‹åï¼Œforwardè·³è½¬</span>
                 <span class="token comment">//.failureUrl(&quot;/login.html&quot;) //é»˜è®¤è®¤è¯å¤±è´¥ä¹‹åï¼Œredirectè·³è½¬</span>
                 <span class="token punctuation">.</span><span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//è®¤è¯å¤±è´¥æ—¶å¤„ç†ï¼Œå‰åç«¯è§£å†³æ–¹æ¡ˆ</span>
                 <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ­¤å¤„å…ˆå…³é—­CSRFè·¨ç«™ä¿æŠ¤</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>æµ‹è¯•è·¯å¾„ï¼šhttp://localhost:8080/helloï¼Œè¾“å…¥é”™è¯¯çš„ç”¨æˆ·åæˆ–å¯†ç åè¾“å‡ºå¦‚ä¸‹ç»“æœï¼š</strong></p> <p><img src="/assets/img/image-20230816092536736.4425ee41.png" alt="image-20230816092536736"></p> <h3 id="_4-5-æ³¨é”€ç™»å½•"><a href="#_4-5-æ³¨é”€ç™»å½•" class="header-anchor">#</a> 4.5 æ³¨é”€ç™»å½•</h3> <blockquote><p>Spring Security ä¸­ä¹Ÿæä¾›äº†é»˜è®¤çš„æ³¨é”€ç™»å½•é…ç½®ï¼Œåœ¨å¼€å‘æ—¶ä¹Ÿå¯ä»¥æŒ‰ç…§è‡ªå·±éœ€æ±‚å¯¹æ³¨é”€è¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶ã€‚</p></blockquote> <p><strong>å¼€å¯æ³¨é”€ç™»å½•ï¼ˆé»˜è®¤å¼€å¯ï¼‰</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfigurer</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>
     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
         http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                 <span class="token punctuation">.</span><span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//è®¤è¯å¤±è´¥æ—¶å¤„ç†ï¼Œå‰åç«¯è§£å†³æ–¹æ¡ˆ</span>
                 <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">logoutUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/logout&quot;</span><span class="token punctuation">)</span><span class="token comment">//æŒ‡å®šæ³¨é”€ç™»å½•URLï¼Œé»˜è®¤è¯·æ±‚æ–¹å¼å¿…é¡»ä¸ºGET</span>
                 <span class="token punctuation">.</span><span class="token function">invalidateHttpSession</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token comment">//é»˜è®¤å¼€å¯ä¼šè¯å¤±æ•ˆ</span>
                 <span class="token punctuation">.</span><span class="token function">clearAuthentication</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token comment">//é»˜è®¤æ¸…é™¤è®¤è¯æ ‡å¿—</span>
                 <span class="token punctuation">.</span><span class="token function">logoutSuccessUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login.html&quot;</span><span class="token punctuation">)</span><span class="token comment">//æ³¨é”€ç™»å½•æˆåŠŸåè·³è½¬çš„é¡µé¢</span>
                 <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ­¤å¤„å…ˆå…³é—­CSRFè·¨ç«™ä¿æŠ¤</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>æµ‹è¯•æ³¨é”€è·¯å¾„ï¼šç™»å½•æˆåŠŸåï¼Œè®¿é—®ï¼šhttp://localhost:8080/helloï¼Œé€šè¿‡è®¿é—®ï¼šhttp://localhost:8080/logoutï¼Œè¿›è¡Œæ³¨é”€ç™»å½•ã€‚</strong></p> <blockquote><p><font style="color:red;font-weight:600;">æ³¨æ„ï¼šÂ Â </font></p> <ul><li>é€šè¿‡<code>logout()</code>æ–¹æ³•å¼€å¯æ³¨é”€ç™»å½•é…ç½®</li> <li><code>logoutUrl</code>æŒ‡å®šé€€å‡ºç™»å½•è¯·æ±‚åœ°å€ï¼Œé»˜è®¤æ˜¯GETè¯·æ±‚ï¼Œè·¯å¾„ä¸º<code>/logout</code></li> <li><code>invalidateHttpSession</code>é€€å‡ºæ—¶æ˜¯å¦ä½¿<code>session</code>å¤±æ•ˆï¼Œé»˜è®¤å€¼ä¸º<code>true</code></li> <li><code>clrarAuthentication</code>é€€å‡ºæ—¶æ˜¯å¦æ¸…é™¤è®¤è¯ä¿¡æ¯ï¼Œé»˜è®¤ä¸º<code>true</code></li> <li><code>logoutSuccessUrl</code>é€€å‡ºç™»å½• æ—¶è·³è½¬åœ°å€</li></ul></blockquote> <p><strong>é…ç½®å¤šä¸ªæ³¨é”€ç™»å½•è¯·æ±‚</strong></p> <blockquote><p>å¦‚æœé¡¹ç›®ä¸­æœ‰éœ€è¦ï¼Œå¼€å‘çœŸå¯ä»¥é…ç½®å¤šä¸ªæ³¨é”€ç™»å½•çš„è¯·æ±‚ï¼ŒåŒæ—¶è¿˜å¯ä»¥æŒ‡å®šè¯·æ±‚çš„æ–¹æ³•ï¼š</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfigurer</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>
     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
         http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                 <span class="token punctuation">.</span><span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//è®¤è¯å¤±è´¥æ—¶å¤„ç†ï¼Œå‰åç«¯è§£å†³æ–¹æ¡ˆ</span>
                 <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token comment">//.logoutUrl(&quot;/logout&quot;)//æŒ‡å®šæ³¨é”€ç™»å½•URLï¼Œé»˜è®¤è¯·æ±‚æ–¹å¼å¿…é¡»ä¸ºGET</span>
                 <span class="token punctuation">.</span><span class="token function">logoutRequestMatcher</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OrRequestMatcher</span><span class="token punctuation">(</span>
                         <span class="token keyword">new</span> <span class="token class-name">AntPathRequestMatcher</span><span class="token punctuation">(</span><span class="token string">&quot;/aaa&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         <span class="token keyword">new</span> <span class="token class-name">AntPathRequestMatcher</span><span class="token punctuation">(</span><span class="token string">&quot;/bbb&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span>
                 <span class="token punctuation">)</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">invalidateHttpSession</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token comment">//é»˜è®¤å¼€å¯ä¼šè¯å¤±æ•ˆ</span>
                 <span class="token punctuation">.</span><span class="token function">clearAuthentication</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token comment">//é»˜è®¤æ¸…é™¤è®¤è¯æ ‡å¿—</span>
                 <span class="token punctuation">.</span><span class="token function">logoutSuccessUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login.html&quot;</span><span class="token punctuation">)</span><span class="token comment">//æ³¨é”€ç™»å½•æˆåŠŸåè·³è½¬çš„é¡µé¢</span>
                 <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ­¤å¤„å…ˆå…³é—­CSRFè·¨ç«™ä¿æŠ¤</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><blockquote><p><font style="color:red;font-weight:600;">æ³¨æ„ï¼šÂ Â </font></p> <ul><li>GETè¯·æ±‚ç›´æ¥åœ¨åœ°å€æ è®¿é—®ï¼Œæ³¨é”€ç™»å½•è·¯å¾„ï¼šhttp://localhost:8080/aaa</li> <li>POSTæ–¹å¼éœ€è¦æ–°å»ºè¡¨å•åŠå¯¹åº”çš„Controllerï¼Œæ³¨é”€ç™»å½•è·¯å¾„ï¼šhttp://localhost:8080/logout.html</li></ul></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogoutController</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;logout.html&quot;</span><span class="token punctuation">)</span>
     <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token string">&quot;logout&quot;</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>å‰åç«¯åˆ†ç¦»æ³¨é”€ç™»å½•é…ç½®</strong></p> <blockquote><p>å¦‚æœæ˜¯å‰åç«¯åˆ†ç¦»å¼€å‘ï¼Œæ³¨é”€æˆåŠŸä¹‹åå°±ä¸éœ€è¦é¡µé¢è·³è½¬äº†ï¼Œåªéœ€è¦å°†æ³¨é”€æˆåŠŸçš„ä¿¡æ¯è¿”å›å‰ç«¯å³å¯ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰<code>LogoutSuccessHandler</code> å®ç°æ¥è¿”å›æ³¨é”€ä¹‹åä¿¡æ¯ï¼š</p></blockquote> <p><strong>ç¼–å†™<code>LogoutSuccessHandler</code>æ¥å£å®ç°ç±»<code>MyLogoutSuccessHandler</code></strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyLogoutSuccessHandler</span> <span class="token keyword">implements</span> <span class="token class-name">LogoutSuccessHandler</span> <span class="token punctuation">{</span>
     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onLogoutSuccess</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
         <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;æ³¨é”€æˆåŠŸï¼Œå½“å‰è®¤è¯å¯¹è±¡ä¸ºï¼š&quot;</span> <span class="token operator">+</span> authentication<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰“å°è®¤è¯ä¿¡æ¯</span>
         result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰“å°çŠ¶æ€ç </span>
         response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è®¾ç½®å“åº”ç±»å‹</span>
         <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//jsonæ ¼å¼è½¬å­—ç¬¦ä¸²</span>
         response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰“å°jsonæ ¼å¼æ•°æ®</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong><code>WebSecurityConfigurer</code>é…ç½®<code>MyLogoutSuccessHandler</code></strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token annotation punctuation">@Configuration</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfigurer</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>
     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
         http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                 <span class="token punctuation">.</span><span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//è®¤è¯å¤±è´¥æ—¶å¤„ç†ï¼Œå‰åç«¯è§£å†³æ–¹æ¡ˆ</span>
                 <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token comment">//.logoutUrl(&quot;/logout&quot;)//æŒ‡å®šæ³¨é”€ç™»å½•URLï¼Œé»˜è®¤è¯·æ±‚æ–¹å¼å¿…é¡»ä¸ºGET</span>
                 <span class="token punctuation">.</span><span class="token function">logoutRequestMatcher</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OrRequestMatcher</span><span class="token punctuation">(</span>
                         <span class="token keyword">new</span> <span class="token class-name">AntPathRequestMatcher</span><span class="token punctuation">(</span><span class="token string">&quot;/aaa&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         <span class="token keyword">new</span> <span class="token class-name">AntPathRequestMatcher</span><span class="token punctuation">(</span><span class="token string">&quot;/bbb&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span>
                 <span class="token punctuation">)</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">invalidateHttpSession</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token comment">//é»˜è®¤å¼€å¯ä¼šè¯å¤±æ•ˆ</span>
                 <span class="token punctuation">.</span><span class="token function">clearAuthentication</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token comment">//é»˜è®¤æ¸…é™¤è®¤è¯æ ‡å¿—</span>
                 <span class="token comment">//.logoutSuccessUrl(&quot;/login.html&quot;)//æ³¨é”€ç™»å½•æˆåŠŸåè·³è½¬çš„é¡µé¢</span>
                 <span class="token punctuation">.</span><span class="token function">logoutSuccessHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyLogoutSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ­¤å¤„å…ˆå…³é—­CSRFè·¨ç«™ä¿æŠ¤</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><strong>æµ‹è¯•è·¯å¾„ï¼šhttp://localhost:8080/aaa</strong></p> <p><img src="/assets/img/image-20230816093808487.45bf5260.png" alt="image-20230816093808487"></p> <p><strong>æµ‹è¯•è·¯å¾„ï¼šhttp://localhost:8080/logout.html</strong></p> <p><img src="/assets/img/image-20230816093902398.3d6a213f.png" alt="image-20230816093902398"></p> <h3 id="_4-6-ç™»å½•ç”¨æˆ·æ•°æ®è·å–"><a href="#_4-6-ç™»å½•ç”¨æˆ·æ•°æ®è·å–" class="header-anchor">#</a> 4.6 ç™»å½•ç”¨æˆ·æ•°æ®è·å–</h3> <h4 id="_4-6-1-securitycontextholderä»‹ç»"><a href="#_4-6-1-securitycontextholderä»‹ç»" class="header-anchor">#</a> 4.6.1 SecurityContextHolderä»‹ç»</h4> <blockquote><p>Spring Security ä¼šå°†ç™»å½•ç”¨æˆ·æ•°æ®ä¿å­˜åœ¨ Session ä¸­ï¼Œä½†æ˜¯ï¼Œä¸ºäº†ä½¿ç”¨æ–¹ä¾¿ï¼ŒSpring Securityåœ¨æ­¤åŸºç¡€ä¸Šè¿˜åšäº†ä¸€äº›æ”¹è¿›ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„ä¸€ä¸ªå˜åŒ–å°±æ˜¯çº¿ç¨‹ç»‘å®šï¼šå½“ç”¨æˆ·ç™»å½•æˆåŠŸåï¼ŒSpring Security ä¼šå°†ç™»å½•æˆåŠŸçš„ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ° SecurityContextHolder ä¸­ã€‚</p> <p>SecurityContextHolder ä¸­çš„æ•°æ®ä¿å­˜é»˜è®¤æ˜¯é€šè¿‡ThreadLocal æ¥å®ç°çš„ï¼Œä½¿ç”¨ ThreadLocal åˆ›å»ºçš„å˜é‡åªèƒ½è¢«å½“å‰çº¿ç¨‹è®¿é—®ï¼Œä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—®å’Œä¿®æ”¹ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·æ•°æ®å’Œè¯·æ±‚çº¿ç¨‹ç»‘å®šåœ¨ä¸€èµ·ã€‚å½“ç™»å½•è¯·æ±‚å¤„ç†å®Œæ¯•åï¼ŒSpring Security ä¼šå°† SecurityContextHolder ä¸­çš„æ•°æ®æ‹¿å‡ºæ¥ä¿å­˜åˆ° Session ä¸­ï¼ŒåŒæ—¶å°† SecurityContextHolder ä¸­çš„æ•°æ®æ¸…ç©ºã€‚ä»¥åæ¯å½“æœ‰è¯·æ±‚åˆ°æ¥æ—¶ï¼ŒSpring Security å°±ä¼šå…ˆä» Session ä¸­å–å‡ºç”¨æˆ·ç™»å½•æ•°æ®ï¼Œä¿å­˜åˆ°SecurityContextHolder ä¸­ï¼Œæ–¹ä¾¿åœ¨è¯¥è¯·æ±‚çš„åç»­å¤„ç†è¿‡ç¨‹ä¸­ä½¿ç”¨ï¼ŒåŒæ—¶åœ¨è¯·æ±‚ç»“æŸæ—¶å°† SecurityContextHolder ä¸­çš„æ•°æ®æ‹¿å‡ºæ¥ä¿å­˜åˆ° Session ä¸­ï¼Œç„¶åå°†SecurityContextHolder ä¸­çš„æ•°æ®æ¸…ç©ºã€‚</p></blockquote> <p><strong>å®é™…ä¸Š SecurityContextHolder ä¸­å­˜å‚¨æ˜¯ SecurityContextï¼Œåœ¨ SecurityContext ä¸­å­˜å‚¨æ˜¯ Authenticationã€‚</strong></p> <p><img src="/assets/img/image-20230816094854796.9e4b4efb.png" alt="image-20230816094854796"></p> <p><strong>è¿™ç§è®¾è®¡æ˜¯å…¸å‹çš„ç­–ç•¥è®¾è®¡æ¨¡å¼ï¼š</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityContextHolder</span> <span class="token punctuation">{</span>
     <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> MODE_THREADLOCAL <span class="token operator">=</span> <span class="token string">&quot;MODE_THREADLOCAL&quot;</span><span class="token punctuation">;</span>
     <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> MODE_INHERITABLETHREADLOCAL <span class="token operator">=</span> <span class="token string">&quot;MODE_INHERITABLETHREADLOCAL&quot;</span><span class="token punctuation">;</span>
     <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> MODE_GLOBAL <span class="token operator">=</span> <span class="token string">&quot;MODE_GLOBAL&quot;</span><span class="token punctuation">;</span>
     <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> MODE_PRE_INITIALIZED <span class="token operator">=</span> <span class="token string">&quot;MODE_PRE_INITIALIZED&quot;</span><span class="token punctuation">;</span>
     <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">SecurityContextHolderStrategy</span> strategy<span class="token punctuation">;</span>
   <span class="token comment">//....</span>
     <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">initializeStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>MODE_PRE_INITIALIZED<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>strategyName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span>strategy <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;When using &quot;</span> <span class="token operator">+</span> MODE_PRE_INITIALIZED
                     <span class="token operator">+</span> <span class="token string">&quot;, setContextHolderStrategy must be called with the fully constructed strategy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">return</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>strategyName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token comment">// Set default</span>
             strategyName <span class="token operator">=</span> MODE_THREADLOCAL<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>strategyName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>MODE_THREADLOCAL<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             strategy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocalSecurityContextHolderStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">return</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>strategyName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>MODE_INHERITABLETHREADLOCAL<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             strategy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InheritableThreadLocalSecurityContextHolderStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">return</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>strategyName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>MODE_GLOBAL<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             strategy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GlobalSecurityContextHolderStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">return</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token comment">//.....</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><blockquote><p><strong>ä¸‰ç§ç­–ç•¥è¯¦ç»†è§£é‡Šï¼š</strong></p> <ol><li>MODE THREADLOCALï¼šè¿™ç§å­˜æ”¾ç­–ç•¥æ˜¯å°† SecurityContext å­˜æ”¾åœ¨ ThreadLocalä¸­ï¼Œå¤§å®¶çŸ¥é“ Threadlocal çš„ç‰¹ç‚¹æ˜¯åœ¨å“ªä¸ªçº¿ç¨‹ä¸­å­˜å‚¨å°±è¦åœ¨å“ªä¸ªçº¿ç¨‹ä¸­è¯»å–ï¼Œè¿™å…¶å®éå¸¸é€‚åˆ web åº”ç”¨ï¼Œå› ä¸ºåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªè¯·æ±‚æ— è®ºç»è¿‡å¤šå°‘ Filter åˆ°è¾¾ Servletï¼Œéƒ½æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†çš„ï¼Œè¿™ä¹Ÿæ˜¯ SecurityContextHolder çš„é»˜è®¤å­˜å‚¨ç­–ç•¥ï¼Œè¿™ç§å­˜å‚¨ç­–ç•¥æ„å‘³ç€å¦‚æœåœ¨å…·ä½“çš„ä¸šåŠ¡å¤„ç†ä»£ç ä¸­ï¼Œå¼€å¯äº†å­çº¿ç¨‹ï¼Œåœ¨å­çº¿ç¨‹ä¸­å»è·å–ç™»å½•ç”¨æˆ·æ•°æ®ï¼Œå°±ä¼šè·å–ä¸åˆ°ã€‚</li> <li>MODE INHERITABLETHREADLOCALï¼šè¿™ç§å­˜å‚¨æ¨¡å¼é€‚ç”¨äºå¤šçº¿ç¨‹ç¯å¢ƒï¼Œå¦‚æœå¸Œæœ›åœ¨å­çº¿ç¨‹ä¸­ä¹Ÿèƒ½å¤Ÿè·å–åˆ°ç™»å½•ç”¨æˆ·æ•°æ®ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨è¿™ç§å­˜å‚¨æ¨¡å¼ï¼Œä½¿ç”¨æ—¶éœ€è¦åœ¨VM Optionså•ç‹¬è¿›è¡Œé…ç½®ï¼ˆå®é™…ä¸Šæ˜¯å°†çˆ¶çº¿ç¨‹çš„ç”¨æˆ·æ•°æ®å¤åˆ¶ä¸€ä»½åˆ°å­çº¿ç¨‹ï¼‰ã€‚</li> <li>MODE GLOBALï¼šè¿™ç§å­˜å‚¨æ¨¡å¼å®é™…ä¸Šæ˜¯å°†æ•°æ®ä¿å­˜åœ¨ä¸€ä¸ªé™æ€å˜é‡ä¸­ï¼Œåœ¨ JavaWebå¼€å‘ä¸­ï¼Œè¿™ç§æ¨¡å¼å¾ˆå°‘ä½¿ç”¨åˆ°ï¼ˆäº†è§£å³å¯ï¼‰ã€‚</li></ol></blockquote> <h4 id="_4-6-2-securitycontextholderstrategyä»‹ç»"><a href="#_4-6-2-securitycontextholderstrategyä»‹ç»" class="header-anchor">#</a> 4.6.2 SecurityContextHolderStrategyä»‹ç»</h4> <blockquote><p>é€šè¿‡ SecurityContextHolder å¯ä»¥å¾—çŸ¥ï¼ŒSecurityContextHolderStrategy æ¥å£ç”¨æ¥å®šä¹‰å­˜å‚¨ç­–ç•¥æ–¹æ³•ï¼š</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SecurityContextHolderStrategy</span> <span class="token punctuation">{</span>
     <span class="token keyword">void</span> <span class="token function">clearContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">SecurityContext</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">void</span> <span class="token function">setContext</span><span class="token punctuation">(</span><span class="token class-name">SecurityContext</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">SecurityContext</span> <span class="token function">createEmptyContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p><strong>æ¥å£ä¸­ä¸€å…±å®šä¹‰äº†å››ä¸ªæ–¹æ³•ï¼š</strong></p> <ul><li>clearContextï¼šè¯¥æ–¹æ³•ç”¨æ¥æ¸…é™¤å­˜å‚¨çš„ SecurityContextå¯¹è±¡ã€‚</li> <li>getContextï¼šè¯¥æ–¹æ³•ç”¨æ¥è·å–å­˜å‚¨çš„ SecurityContext å¯¹è±¡ã€‚</li> <li>setContextï¼šè¯¥æ–¹æ³•ç”¨æ¥è®¾ç½®å­˜å‚¨çš„ SecurityContext å¯¹è±¡ã€‚</li> <li>createEmptyContextï¼šè¯¥æ–¹æ³•åˆ™ç”¨æ¥åˆ›å»ºä¸€ä¸ªç©ºçš„ SecurityContext å¯¹è±¡ã€‚</li></ul></blockquote> <p><img src="/assets/img/image-20230816095214967.207d442b.png" alt="image-20230816095214967"></p> <h4 id="_4-6-3-ä»£ç ä¸­è·å–è®¤è¯ä¹‹åçš„ç”¨æˆ·æ•°æ®"><a href="#_4-6-3-ä»£ç ä¸­è·å–è®¤è¯ä¹‹åçš„ç”¨æˆ·æ•°æ®" class="header-anchor">#</a> 4.6.3 ä»£ç ä¸­è·å–è®¤è¯ä¹‹åçš„ç”¨æˆ·æ•°æ®</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>
     <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
     <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Spring Security!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">Authentication</span> authentication <span class="token operator">=</span> <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è·å¾—è®¤è¯ä¿¡æ¯</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;authentication.getName() = &quot;</span> <span class="token operator">+</span> authentication<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;authentication.getAuthorities() = &quot;</span> <span class="token operator">+</span> authentication<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;authentication.getCredentials() = &quot;</span> <span class="token operator">+</span> authentication<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;authentication.getDetails() = &quot;</span> <span class="token operator">+</span> authentication<span class="token punctuation">.</span><span class="token function">getDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;authentication.getPrincipal() = &quot;</span> <span class="token operator">+</span> authentication<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
         <span class="token class-name">User</span> principal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> authentication<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿”å›å€¼ç±»å‹ä¸ºUseræ—¶éœ€è¦è¿›è¡Œå¼ºåˆ¶è½¬æ¢ org.springframework.security.core.userdetails.User</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;principal.getUsername() = &quot;</span> <span class="token operator">+</span> principal<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;principal.getPassword() = &quot;</span> <span class="token operator">+</span> principal<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;principal.getAuthorities() = &quot;</span> <span class="token operator">+</span> principal<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token string">&quot;hello spring security!&quot;</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>å¯åŠ¨æœåŠ¡ï¼Œç™»å½•æˆåŠŸåè®¿é—®ï¼šhttp://localhost:8080/helloï¼Œè·å¾—è®¤è¯ä¹‹åçš„ç”¨æˆ·æ•°æ®ã€‚</strong></p> <p><strong>IDEAæ§åˆ¶å°è¾“å‡ºç»“æœï¼š</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code> Hello Spring Security!
 authentication.getName() = root
 authentication.getAuthorities() = [ROLE_admin, ROLE_super]
 authentication.getCredentials() = null
 authentication.getDetails() = WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=15FEA49E4810C435286FD8B6D188C87F]
 authentication.getPrincipal() = org.springframework.security.core.userdetails.User [Username=root, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, credentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_admin, ROLE_super]]
 principal.getUsername() = root
 principal.getPassword() = null
 principal.getAuthorities() = [ROLE_admin, ROLE_super]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_4-6-4-å¤šçº¿ç¨‹æƒ…å†µä¸‹è·å–ç”¨æˆ·æ•°æ®"><a href="#_4-6-4-å¤šçº¿ç¨‹æƒ…å†µä¸‹è·å–ç”¨æˆ·æ•°æ®" class="header-anchor">#</a> 4.6.4 å¤šçº¿ç¨‹æƒ…å†µä¸‹è·å–ç”¨æˆ·æ•°æ®</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token annotation punctuation">@RestController</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>
     <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
     <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Spring Security!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
             <span class="token class-name">Authentication</span> <span class="token class-name">Authentication</span> <span class="token operator">=</span> <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token class-name">User</span> childPrincipal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> <span class="token class-name">Authentication</span><span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Principal.getUsername() = &quot;</span> <span class="token operator">+</span> <span class="token class-name">Principal</span><span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Principal.getPassword() = &quot;</span> <span class="token operator">+</span> <span class="token class-name">Principal</span><span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Principal.getAuthorities() = &quot;</span> <span class="token operator">+</span> <span class="token class-name">Principal</span><span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token string">&quot;hello spring security!&quot;</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>å¯åŠ¨æœåŠ¡ï¼Œè®¿é—®ï¼šhttp://localhost:8080/helloï¼Œè·å¾—è®¤è¯ä¹‹åçš„ç”¨æˆ·æ•°æ®ã€‚</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code> Exception in thread &quot;Thread-2&quot; java.lang.NullPointerException
     at com.study.controller.HelloController.lambda$hello$0(HelloController.java:35)
     at java.lang.Thread.run(Thread.java:750)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°é»˜è®¤ç­–ç•¥ï¼Œæ˜¯æ— æ³•åœ¨å­çº¿ç¨‹ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœéœ€è¦åœ¨å­çº¿ç¨‹ä¸­è·å–å¿…é¡»ä½¿ç”¨ç¬¬äºŒç§ç­–ç•¥ï¼Œé»˜è®¤ç­–ç•¥æ˜¯é€šè¿‡ System.getProperty åŠ è½½çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡å¢åŠ  VM Options å‚æ•°è¿›è¡Œä¿®æ”¹ã€‚</strong></p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">-Dspring.security.strategy</span><span class="token punctuation">=</span><span class="token attr-value">MODE_INHERITABLETHREADLOCAL</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20230816095705063.13b9f5e0.png" alt="image-20230816095705063"></p> <p>å¯åŠ¨æœåŠ¡ï¼Œè®¿é—®ï¼šhttp://localhost:8080/helloï¼Œè·å¾—è®¤è¯ä¹‹åçš„ç”¨æˆ·æ•°æ®ã€‚</p> <p>IDEAæ§åˆ¶å°è¾“å‡ºç»“æœï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> Hello Spring Security!
 Principal.getUsername() = root
 Principal.getPassword() = null
 Principal.getAuthorities() = [ROLE_admin, ROLE_super]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_4-6-5-é¡µé¢ä¸Šè·å–ç”¨æˆ·ä¿¡æ¯"><a href="#_4-6-5-é¡µé¢ä¸Šè·å–ç”¨æˆ·ä¿¡æ¯" class="header-anchor">#</a> 4.6.5 é¡µé¢ä¸Šè·å–ç”¨æˆ·ä¿¡æ¯</h4> <p><strong>pom.xmlä¸­å¼•å…¥ä¾èµ–</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.thymeleaf.extras<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>thymeleaf-extras-springsecurity5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.4.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>logout.htmlé¡µé¢åŠ å…¥å‘½åç©ºé—´</strong></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://www.thymeleaf.org<span class="token punctuation">&quot;</span></span> 
 <span class="token attr-name"><span class="token namespace">xmlns:</span>sec</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.thymeleaf.org/extras/spring-security<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 
 ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>logout.htmlé¡µé¢ä¸­è·å–ç”¨æˆ·ä¿¡æ¯</strong></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!--è·å–è®¤è¯ç”¨æˆ·å--&gt;</span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name"><span class="token namespace">sec:</span>authentication</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>principal.username<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name"><span class="token namespace">sec:</span>authentication</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>principal.authorities<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name"><span class="token namespace">sec:</span>authentication</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>principal.accountNonExpired<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name"><span class="token namespace">sec:</span>authentication</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>principal.accountNonLocked<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name"><span class="token namespace">sec:</span>authentication</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>principal.credentialsNonExpired<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>å¯åŠ¨æœåŠ¡ï¼Œç™»å½•æˆåŠŸåè®¿é—®logout.htmlï¼šhttp://localhost:8080/logout.html</strong></p> <p><img src="/assets/img/image-20230816100002183.c1e2d4b9.png" alt="image-20230816100002183"></p> <h3 id="_4-7-è‡ªå®šä¹‰è®¤è¯æ•°æ®æº"><a href="#_4-7-è‡ªå®šä¹‰è®¤è¯æ•°æ®æº" class="header-anchor">#</a> 4.7 è‡ªå®šä¹‰è®¤è¯æ•°æ®æº</h3> <p><img src="/assets/img/image-20230816101412952.2b5fdf29.png" alt="image-20230816101412952"></p> <ol><li>å‘èµ·è®¤è¯è¯·æ±‚ï¼Œè¯·æ±‚ä¸­æºå¸¦ç”¨æˆ·åã€å¯†ç ï¼Œè¯¥è¯·æ±‚ä¼šè¢«<font style="color:orange;font-weight:600;">UsernamePasswordAuthenticationFilterÂ </font>æ‹¦æˆª</li> <li>åœ¨<font style="color:orange;font-weight:600;">Â UsernamePasswordAuthenticationÂ </font>çš„<font style="color:orange;font-weight:600;">attempAuthenticationÂ Â </font>æ–¹æ³•ä¸­å°†è¯·æ±‚ä¸­ç”¨æˆ·åå’Œå¯†ç å°è£…ä¸º<font style="color:orange;font-weight:600;">Â Authentication</font>å¯¹è±¡ï¼Œå¹¶äº¤ç»™<font style="color:orange;font-weight:600;">Â AuthenticationManagerÂ </font>è¿›è¡Œè®¤è¯</li> <li>è®¤è¯æˆåŠŸï¼Œå°†è®¤è¯ä¿¡æ¯å­˜å‚¨åˆ°<font style="color:orange;font-weight:600;">  SecurityContextHodler  </font>ä»¥åŠè°ƒç”¨è®°ä½æˆ‘ç­‰ï¼Œå¹¶å›è°ƒ <font style="color:orange;font-weight:600;"> AuthenticationSuccessHandler </font> å¤„ç†</li> <li>è®¤è¯å¤±è´¥ï¼Œæ¸…é™¤ <font style="color:orange;font-weight:600;"> SecurityContextHodler  </font>ä»¥åŠ è®°ä½æˆ‘ä¸­ä¿¡æ¯ï¼Œå›è°ƒ <font style="color:orange;font-weight:600;"> AuthenticationFailureHandler </font> å¤„ç†</li></ol></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2023/09/22, 19:38:21</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/eedb43/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">ä¸‰ã€ç¯å¢ƒæ­å»º</div></a> <a href="/pages/202d71/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">ä¸€ã€JMSä¸æ¶ˆæ¯ä¸­é—´ä»¶</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/pages/eedb43/" class="prev">ä¸‰ã€ç¯å¢ƒæ­å»º</a></span> <span class="next"><a href="/pages/202d71/">ä¸€ã€JMSä¸æ¶ˆæ¯ä¸­é—´ä»¶</a>â†’
      </span></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2023-2024
    <span>yli | æœ¬åšå®¢æ˜¯ä¸ªäººçš„å­¦ä¹ ç¬”è®°ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åˆ é™¤ï¼Œå¾®ä¿¡ï¼šy17616193585</span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.395b465c.js" defer></script><script src="/assets/js/2.46ebd511.js" defer></script><script src="/assets/js/15.a28d648f.js" defer></script>
  </body>
</html>
